function buildIOSMeta(){for(var e=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],t=0;t<e.length;t++){var n=document.createElement("meta");n.name=e[t].name,n.content=e[t].content;var i=window.document.head.querySelector('meta[name="'+n.name+'"]');i&&i.parentNode.removeChild(i),window.document.head.appendChild(n)}}function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none"),jQuery(".xxx-ios-fullscreen-scroll").css("display","none"),jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block"),jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}function __iosResize(){if(window.scrollTo(0,0),console.log(window.devicePixelRatio),console.log(window.innerWidth),console.log(window.innerHeight),"iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize(),setTimeout(function(){__iosResize()},500)}function iosInIframe(){try{return window.self!==window.top}catch(e){return!0}}function isIOSLessThen13(){var e=platform.os,t=e.family.toLowerCase();return e=parseFloat(e.version),"ios"===t&&13>e}(function(){function e(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function t(t){return t=String(t).replace(/^ +| +$/g,""),/^(?:webOS|i(?:OS|P))/.test(t)?t:e(t)}function n(e,t){for(var n in e)d.call(e,n)&&t(e[n],n,e)}function i(t){return null==t?e(t):_.call(t).slice(8,-1)}function a(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function r(e,t){var i=null;return function(e,t){var i=-1,a=e?e.length:0;if("number"==typeof a&&-1<a&&a<=u)for(;++i<a;)t(e[i],i,e);else n(e,t)}(e,function(n,a){i=t(i,n,a,e)}),i}var s={function:!0,object:!0},o=s[typeof window]&&window||this,l=s[typeof exports]&&exports;s=s[typeof module]&&module&&!module.nodeType&&module;var c=l&&s&&"object"==typeof global&&global;!c||c.global!==c&&c.window!==c&&c.self!==c||(o=c);var u=Math.pow(2,53)-1,h=/\bOpera/,d=(c=Object.prototype).hasOwnProperty,_=c.toString,p=function e(s){function l(e){return r(e,function(e,n){var i=n.pattern||a(n);return!e&&(e=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(s)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(s)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(s))&&((e=String(n.label&&!RegExp(i,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=t(e[0].replace(RegExp(i,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e})}var c=o,u=s&&"object"==typeof s&&"String"!=i(s);u&&(c=s,s=null);var d=c.navigator||{},p=d.userAgent||"";s||(s=p);var f=u?!!d.likeChrome:/\bChrome\b/.test(s)&&!/internal|\n/i.test(_.toString()),g=u?"Object":"ScriptBridgingProxyObject",C=u?"Object":"Environment",S=u&&c.java?"JavaPackage":i(c.java),m=u?"Object":"RuntimeObject";C=(S=/\bJava/.test(S)&&c.java)&&i(c.environment)==C;var b,T=S?"a":"α",y=S?"b":"β",A=c.document||{},w=c.operamini||c.opera,E=h.test(E=u&&w?w["[[Class]]"]:i(w))?E:w=null,x=s;u=[];var O=null,v=s==p;p=v&&w&&"function"==typeof w.version&&w.version();var P=r([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(e,t){return e||RegExp("\\b"+(t.pattern||a(t))+"\\b","i").exec(s)&&(t.label||t)}),I=r(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],function(e,t){return e||RegExp("\\b"+(t.pattern||a(t))+"\\b","i").exec(s)&&(t.label||t)}),N=l([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),L=r({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}},function(e,t,n){return e||(t[N]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(N)]||RegExp("\\b"+a(n)+"(?:\\b|\\w*\\d)","i").exec(s))&&n}),M=r(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],function(e,n){var i=n.pattern||a(n);if(!e&&(e=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(s))){var r=e,o=n.label||n,l={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};i&&o&&/^Win/i.test(r)&&!/^Windows Phone /i.test(r)&&(l=l[/[\d.]+$/.exec(r)])&&(r="Windows "+l),r=String(r),i&&o&&(r=r.replace(RegExp(i,"i"),o)),e=r=t(r.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return e});if(P&&(P=[P]),L&&!N&&(N=l([L])),(b=/\bGoogle TV\b/.exec(N))&&(N=b[0]),/\bSimulator\b/i.test(s)&&(N=(N?N+" ":"")+"Simulator"),"Opera Mini"==I&&/\bOPiOS\b/.test(s)&&u.push("running in Turbo/Uncompressed mode"),"IE"==I&&/\blike iPhone OS\b/.test(s)?(L=(b=e(s.replace(/like iPhone OS/,""))).manufacturer,N=b.product):/^iP/.test(N)?(I||(I="Safari"),M="iOS"+((b=/ OS ([\d_]+)/i.exec(s))?" "+b[1].replace(/_/g,"."):"")):"Konqueror"!=I||/buntu/i.test(M)?L&&"Google"!=L&&(/Chrome/.test(I)&&!/\bMobile Safari\b/i.test(s)||/\bVita\b/.test(N))||/\bAndroid\b/.test(M)&&/^Chrome/.test(I)&&/\bVersion\//i.test(s)?(I="Android Browser",M=/\bAndroid\b/.test(M)?M:"Android"):"Silk"==I?(/\bMobi/i.test(s)||(M="Android",u.unshift("desktop mode")),/Accelerated *= *true/i.test(s)&&u.unshift("accelerated")):"PaleMoon"==I&&(b=/\bFirefox\/([\d.]+)\b/.exec(s))?u.push("identifying as Firefox "+b[1]):"Firefox"==I&&(b=/\b(Mobile|Tablet|TV)\b/i.exec(s))?(M||(M="Firefox OS"),N||(N=b[1])):!I||(b=!/\bMinefield\b/i.test(s)&&/\b(?:Firefox|Safari)\b/.exec(I))?(I&&!N&&/[\/,]|^[^(]+?\)/.test(s.slice(s.indexOf(b+"/")+8))&&(I=null),(b=N||L||M)&&(N||L||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(M))&&(I=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(M)?M:b)+" Browser")):"Electron"==I&&(b=(/\bChrome\/([\d.]+)\b/.exec(s)||0)[1])&&u.push("Chromium "+b):M="Kubuntu",p||(p=r(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",a(I),"(?:Firefox|Minefield|NetFront)"],function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(s)||0)[1]||null})),(b=("iCab"==P&&3<parseFloat(p)?"WebKit":/\bOpera\b/.test(I)&&(/\bOPR\b/.test(s)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(s)&&!/^(?:Trident|EdgeHTML)$/.test(P)&&"WebKit"||!P&&/\bMSIE\b/i.test(s)&&("Mac OS"==M?"Tasman":"Trident")||"WebKit"==P&&/\bPlayStation\b(?! Vita\b)/i.test(I)&&"NetFront")&&(P=[b]),"IE"==I&&(b=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(s)||0)[1])?(I+=" Mobile",M="Windows Phone "+(/\+$/.test(b)?b:b+".x"),u.unshift("desktop mode")):/\bWPDesktop\b/i.test(s)?(I="IE Mobile",M="Windows Phone 8.x",u.unshift("desktop mode"),p||(p=(/\brv:([\d.]+)/.exec(s)||0)[1])):"IE"!=I&&"Trident"==P&&(b=/\brv:([\d.]+)/.exec(s))&&(I&&u.push("identifying as "+I+(p?" "+p:"")),I="IE",p=b[1]),v){if(function(e,t){var n=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}(c,"global"))if(S&&(x=(b=S.lang.System).getProperty("os.arch"),M=M||b.getProperty("os.name")+" "+b.getProperty("os.version")),C){try{p=c.require("ringo/engine").version.join("."),I="RingoJS"}catch(e){(b=c.system)&&b.global.system==c.system&&(I="Narwhal",M||(M=b[0].os||null))}I||(I="Rhino")}else"object"==typeof c.process&&!c.process.browser&&(b=c.process)&&("object"==typeof b.versions&&("string"==typeof b.versions.electron?(u.push("Node "+b.versions.node),I="Electron",p=b.versions.electron):"string"==typeof b.versions.nw&&(u.push("Chromium "+p,"Node "+b.versions.node),I="NW.js",p=b.versions.nw)),I||(I="Node.js",x=b.arch,M=b.platform,p=(p=/[\d.]+/.exec(b.version))?p[0]:null));else i(b=c.runtime)==g?(I="Adobe AIR",M=b.flash.system.Capabilities.os):i(b=c.phantom)==m?(I="PhantomJS",p=(b=b.version||null)&&b.major+"."+b.minor+"."+b.patch):"number"==typeof A.documentMode&&(b=/\bTrident\/(\d+)/i.exec(s))?(p=[p,A.documentMode],(b=+b[1]+4)!=p[1]&&(u.push("IE "+p[1]+" mode"),P&&(P[1]=""),p[1]=b),p="IE"==I?String(p[1].toFixed(1)):p[0]):"number"==typeof A.documentMode&&/^(?:Chrome|Firefox)\b/.test(I)&&(u.push("masking as "+I+" "+p),I="IE",p="11.0",P=["Trident"],M="Windows");M=M&&t(M)}if(p&&(b=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(p)||/(?:alpha|beta)(?: ?\d)?/i.exec(s+";"+(v&&d.appMinorVersion))||/\bMinefield\b/i.test(s)&&"a")&&(O=/b/i.test(b)?"beta":"alpha",p=p.replace(RegExp(b+"\\+?$"),"")+("beta"==O?y:T)+(/\d+\+?/.exec(b)||"")),"Fennec"==I||"Firefox"==I&&/\b(?:Android|Firefox OS)\b/.test(M))I="Firefox Mobile";else if("Maxthon"==I&&p)p=p.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(N))"Xbox 360"==N&&(M=null),"Xbox 360"==N&&/\bIEMobile\b/.test(s)&&u.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(I)&&(!I||N||/Browser|Mobi/.test(I))||"Windows CE"!=M&&!/Mobi/i.test(s))if("IE"==I&&v)try{null===c.external&&u.unshift("platform preview")}catch(e){u.unshift("embedded")}else(/\bBlackBerry\b/.test(N)||/\bBB10\b/.test(s))&&(b=(RegExp(N.replace(/ +/g," *")+"/([.\\d]+)","i").exec(s)||0)[1]||p)?(M=((b=[b,/BB10/.test(s)])[1]?(N=null,L="BlackBerry"):"Device Software")+" "+b[0],p=null):this!=n&&"Wii"!=N&&(v&&w||/Opera/.test(I)&&/\b(?:MSIE|Firefox)\b/i.test(s)||"Firefox"==I&&/\bOS X (?:\d+\.){2,}/.test(M)||"IE"==I&&(M&&!/^Win/.test(M)&&5.5<p||/\bWindows XP\b/.test(M)&&8<p||8==p&&!/\bTrident\b/.test(s)))&&!h.test(b=e.call(n,s.replace(h,"")+";"))&&b.name&&(b="ing as "+b.name+((b=b.version)?" "+b:""),h.test(I)?(/\bIE\b/.test(b)&&"Mac OS"==M&&(M=null),b="identify"+b):(b="mask"+b,I=E?t(E.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(b)&&(M=null),v||(p=null)),P=["Presto"],u.push(b));else I+=" Mobile";if((b=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(s)||0)[1])&&(b=[parseFloat(b.replace(/\.(\d)$/,".0$1")),b],"Safari"==I&&"+"==b[1].slice(-1)?(I="WebKit Nightly",O="alpha",p=b[1].slice(0,-1)):p!=b[1]&&p!=(b[2]=(/\bSafari\/([\d.]+\+?)/i.exec(s)||0)[1])||(p=null),b[1]=(/\bChrome\/([\d.]+)/i.exec(s)||0)[1],537.36==b[0]&&537.36==b[2]&&28<=parseFloat(b[1])&&"WebKit"==P&&(P=["Blink"]),v&&(f||b[1])?(P&&(P[1]="like Chrome"),b=b[1]||(530>(b=b[0])?1:532>b?2:532.05>b?3:533>b?4:534.03>b?5:534.07>b?6:534.1>b?7:534.13>b?8:534.16>b?9:534.24>b?10:534.3>b?11:535.01>b?12:535.02>b?"13+":535.07>b?15:535.11>b?16:535.19>b?17:536.05>b?18:536.1>b?19:537.01>b?20:537.11>b?"21+":537.13>b?23:537.18>b?24:537.24>b?25:537.36>b?26:"Blink"!=P?"27":"28")):(P&&(P[1]="like Safari"),b=400>(b=b[0])?1:500>b?2:526>b?3:533>b?4:534>b?"4+":535>b?5:537>b?6:538>b?7:601>b?8:"8"),P&&(P[1]+=" "+(b+="number"==typeof b?".x":/[.+]/.test(b)?"":"+")),"Safari"==I&&(!p||45<parseInt(p))&&(p=b)),"Opera"==I&&(b=/\bzbov|zvav$/.exec(M))?(I+=" ",u.unshift("desktop mode"),"zvav"==b?(I+="Mini",p=null):I+="Mobile",M=M.replace(RegExp(" *"+b+"$"),"")):"Safari"==I&&/\bChrome\b/.exec(P&&P[1])&&(u.unshift("desktop mode"),I="Chrome Mobile",p=null,/\bOS X\b/.test(M)?(L="Apple",M="iOS 4.3+"):M=null),p&&0==p.indexOf(b=/[\d.]+$/.exec(M))&&-1<s.indexOf("/"+b+"-")&&(M=String(M.replace(b,"")).replace(/^ +| +$/g,"")),P&&!/\b(?:Avant|Nook)\b/.test(I)&&(/Browser|Lunascape|Maxthon/.test(I)||"Safari"!=I&&/^iOS/.test(M)&&/\bSafari\b/.test(P[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(I)&&P[1])&&(b=P[P.length-1])&&u.push(b),u.length&&(u=["("+u.join("; ")+")"]),L&&N&&0>N.indexOf(L)&&u.push("on "+L),N&&u.push((/^on /.test(u[u.length-1])?"":"on ")+N),M){var H=(b=/ ([\d.+]+)$/.exec(M))&&"/"==M.charAt(M.length-b[0].length-1);M={architecture:32,family:b&&!H?M.replace(b[0],""):M,version:b?b[1]:null,toString:function(){var e=this.version;return this.family+(e&&!H?" "+e:"")+(64==this.architecture?" 64-bit":"")}}}return(b=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(x))&&!/\bi686\b/i.test(x)?(M&&(M.architecture=64,M.family=M.family.replace(RegExp(" *"+b),"")),I&&(/\bWOW64\b/i.test(s)||v&&/\w(?:86|32)$/.test(d.cpuClass||d.platform)&&!/\bWin64; x64\b/i.test(s))&&u.unshift("32-bit")):M&&/^OS X/.test(M.family)&&"Chrome"==I&&39<=parseFloat(p)&&(M.architecture=64),s||(s=null),(c={}).description=s,c.layout=P&&P[0],c.manufacturer=L,c.name=I,c.prerelease=O,c.product=N,c.ua=s,c.version=I&&p,c.os=M||{architecture:null,family:null,version:null,toString:function(){return"null"}},c.parse=e,c.toString=function(){return this.description||""},c.version&&u.unshift(p),c.name&&u.unshift(I),M&&I&&(M!=String(M).split(" ")[0]||M!=I.split(" ")[0]&&!N)&&u.push(N?"("+M+")":"on "+M),u.length&&(c.description=u.join(" ")),c}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(o.platform=p,define(function(){return p})):l&&s?n(p,function(e,t){l[t]=e}):o.platform=p}).call(this),$(document).ready(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())}),jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&iosResize()}),function(){var e="undefined"!=typeof window&&void 0!==window.document?window.document:{},t="undefined"!=typeof module&&module.exports,n=function(){for(var t,n=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],i=0,a=n.length,r={};i<a;i++)if((t=n[i])&&t[1]in e){for(i=0;i<t.length;i++)r[n[0][i]]=t[i];return r}return!1}(),i={change:n.fullscreenchange,error:n.fullscreenerror},a={request:function(t){return new Promise(function(i,a){var r=function(){this.off("change",r),i()}.bind(this);this.on("change",r),t=t||e.documentElement,Promise.resolve(t[n.requestFullscreen]()).catch(a)}.bind(this))},exit:function(){return new Promise(function(t,i){if(this.isFullscreen){var a=function(){this.off("change",a),t()}.bind(this);this.on("change",a),Promise.resolve(e[n.exitFullscreen]()).catch(i)}else t()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(t,n){var a=i[t];a&&e.addEventListener(a,n,!1)},off:function(t,n){var a=i[t];a&&e.removeEventListener(a,n,!1)},raw:n};n?(Object.defineProperties(a,{isFullscreen:{get:function(){return!!e[n.fullscreenElement]}},element:{enumerable:!0,get:function(){return e[n.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!e[n.fullscreenEnabled]}}}),t?module.exports=a:window.screenfull=a):t?module.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}();var s_iOffsetX,s_iOffsetY,s_iScaleFactor=1,s_bIsIphone=!1,s_bFocus=!0;function trace(e){console.log(e)}function getSize(e){var t=e.toLowerCase(),n=window.document,i=n.documentElement;if(void 0===window["inner"+e])e=i["client"+e];else if(window["inner"+e]!=i["client"+e]){var a=n.createElement("body");a.id="vpw-test-b",a.style.cssText="overflow:scroll";var r=n.createElement("div");r.id="vpw-test-d",r.style.cssText="position:absolute;top:-1000px",r.innerHTML="<style>@media("+t+":"+i["client"+e]+"px){body#vpw-test-b div#vpw-test-d{"+t+":7px!important}}</style>",a.appendChild(r),i.insertBefore(a,n.head),e=7==r["offset"+e]?i["client"+e]:window["inner"+e],i.removeChild(a)}else e=window["inner"+e];return e}function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler(),window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function isMobile(){return!!isIpad()||jQuery.browser.mobile}function isIpad(){var e=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!!(!e&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints)||e}function isIOS(){for(var e="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");e.length;)if(navigator.platform===e.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var e=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<e?e:0}function sizeHandler(){if(window.scrollTo(0,1),$("#canvas")){var e=null!==platform.name&&"safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height"),t=getSize("Width");s_bFocus&&_checkOrientation(t,e);var n=Math.min(e/CANVAS_HEIGHT,t/CANVAS_WIDTH),i=Math.round(CANVAS_WIDTH*n);if((n=Math.round(CANVAS_HEIGHT*n))<e){var a=e-n;n+=a,i+=CANVAS_WIDTH/CANVAS_HEIGHT*a}else i<t&&(i+=a=t-i,n+=CANVAS_HEIGHT/CANVAS_WIDTH*a);a=e/2-n/2;var r=t/2-i/2,s=CANVAS_WIDTH/i;(r*s<-EDGEBOARD_X||a*s<-EDGEBOARD_Y)&&(n=Math.min(e/(CANVAS_HEIGHT-2*EDGEBOARD_Y),t/(CANVAS_WIDTH-2*EDGEBOARD_X)),i=Math.round(CANVAS_WIDTH*n),a=(e-(n=Math.round(CANVAS_HEIGHT*n)))/2,r=(t-i)/2,s=CANVAS_WIDTH/i),s_iOffsetX=-1*r*s,s_iOffsetY=-1*a*s,0<=a&&(s_iOffsetY=0),0<=r&&(s_iOffsetX=0),null!==s_oInterface&&s_oInterface.refreshButtonPos(),null!==s_oMenu&&s_oMenu.refreshButtonPos(),null!==s_oSelectPlayers&&s_oSelectPlayers.refreshButtonPos(),$("#canvas").css("width",i+"px"),$("#canvas").css("height",n+"px"),0>a||(a=(e-n)/2),$("#canvas").css("top",a+"px"),$("#canvas").css("left",r+"px"),fullscreenHandler()}}function _checkOrientation(e,t){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(e>t?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()))}function playSound(e,t,n){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[e].play(),s_aSounds[e].volume(t),s_aSounds[e].loop(n),s_aSounds[e]):null}function stopSound(e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].stop()}function setVolume(e,t){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].volume(t)}function setMute(e,t){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[e].mute(t)}function createBitmap(e,t,n){var i=new createjs.Bitmap(e),a=new createjs.Shape;return t&&n?a.graphics.beginFill("#fff").drawRect(0,0,t,n):a.graphics.beginFill("#ff0").drawRect(0,0,e.width,e.height),i.hitArea=a,i}function createSprite(e,t,n,i,a,r){return e=null!==t?new createjs.Sprite(e,t):new createjs.Sprite(e),(t=new createjs.Shape).graphics.beginFill("#000000").drawRect(-n,-i,a,r),e.hitArea=t,e}function pad(e,t,n){return(e+="").length>=t?e:Array(t-e.length+1).join(n||"0")+e}function linearFunction(e,t,n,i,a){return(e-t)*(a-i)/(n-t)+i}function randomFloatBetween(e,t,n){return void 0===n&&(n=2),parseFloat(Math.min(e+Math.random()*(t-e),t).toFixed(n))}function rotateVector2D(e,t){var n=t.getX()*Math.cos(e)+t.getY()*Math.sin(e),i=t.getX()*-Math.sin(e)+t.getY()*Math.cos(e);t.set(n,i)}function tweenVectorsOnX(e,t,n){return e+n*(t-e)}function shuffle(e){for(var t,n,i=e.length;0!==i;)n=Math.floor(Math.random()*i),t=e[--i],e[i]=e[n],e[n]=t;return e}function bubbleSort(e){do{for(var t=!1,n=0;n<e.length-1;n++)e[n]>e[n+1]&&(t=e[n],e[n]=e[n+1],e[n+1]=t,t=!0)}while(t)}function compare(e,t){return e.index>t.index?-1:e.index<t.index?1:0}function CircularList(e,t){this.arr=e,this.currentIndex=t||0}function easeLinear(e,t,n,i){return n*e/i+t}function easeInQuad(e,t,n,i){return n*(e/=i)*e+t}function easeInSine(e,t,n,i){return-n*Math.cos(e/i*(Math.PI/2))+n+t}function easeInCubic(e,t,n,i){return n*(e/=i)*e*e+t}function getTrajectoryPoint(e,t){var n=new createjs.Point,i=(1-e)*(1-e),a=e*e;return n.x=i*t.start.x+2*(1-e)*e*t.traj.x+a*t.end.x,n.y=i*t.start.y+2*(1-e)*e*t.traj.y+a*t.end.y,n}function formatTime(e){e/=1e3;var t=Math.floor(e/60),n="";return n=10>t?n+"0"+t+":":n+(t+":"),10>(e=parseFloat(e-60*t).toFixed(1))?n+"0"+e:n+e}function degreesToRadians(e){return e*Math.PI/180}function checkRectCollision(e,t){return calculateIntersection(getBounds(e,.9),getBounds(t,.98))}function calculateIntersection(e,t){var n,i,a,r,s=e.x+(n=e.width/2),o=e.y+(i=e.height/2),l=t.x+(a=t.width/2),c=t.y+(r=t.height/2);return s=Math.abs(s-l)-(n+a),o=Math.abs(o-c)-(i+r),0>s&&0>o?(s=Math.min(Math.min(e.width,t.width),-s),o=Math.min(Math.min(e.height,t.height),-o),{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y),width:s,height:o,rect1:e,rect2:t}):null}function getBounds(e,t){var n={x:1/0,y:1/0,width:0,height:0};if(e instanceof createjs.Container){n.x2=-1/0,n.y2=-1/0;var i,a=e.children,r=a.length;for(i=0;i<r;i++){var s=getBounds(a[i],1);s.x<n.x&&(n.x=s.x),s.y<n.y&&(n.y=s.y),s.x+s.width>n.x2&&(n.x2=s.x+s.width),s.y+s.height>n.y2&&(n.y2=s.y+s.height)}1/0==n.x&&(n.x=0),1/0==n.y&&(n.y=0),1/0==n.x2&&(n.x2=0),1/0==n.y2&&(n.y2=0),n.width=n.x2-n.x,n.height=n.y2-n.y,delete n.x2,delete n.y2}else{if(e instanceof createjs.Bitmap){i=(r=e.sourceRect||e.image).width*t;var o=r.height*t}else if(e instanceof createjs.Sprite)if(e.spriteSheet._frames&&e.spriteSheet._frames[e.currentFrame]&&e.spriteSheet._frames[e.currentFrame].image){i=(r=e.spriteSheet.getFrame(e.currentFrame)).rect.width,o=r.rect.height,a=r.regX;var l=r.regY}else n.x=e.x||0,n.y=e.y||0;else n.x=e.x||0,n.y=e.y||0;a=a||0,i=i||0,l=l||0,o=o||0,n.regX=a,n.regY=l,r=e.localToGlobal(0-a,0-l),s=e.localToGlobal(i-a,o-l),i=e.localToGlobal(i-a,0-l),a=e.localToGlobal(0-a,o-l),n.x=Math.min(Math.min(Math.min(r.x,s.x),i.x),a.x),n.y=Math.min(Math.min(Math.min(r.y,s.y),i.y),a.y),n.width=Math.max(Math.max(Math.max(r.x,s.x),i.x),a.x)-n.x,n.height=Math.max(Math.max(Math.max(r.y,s.y),i.y),a.y)-n.y}return n}function NoClickDelay(e){this.element=e,window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(e){for(var t,n,i=e.length;0<i;)n=Math.floor(Math.random()*i),t=e[--i],e[i]=e[n],e[n]=t;return e}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}function getParamValue(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var i=t[n].split("=");if(i[0]==e)return i[1]}}function fullscreenHandler(){ENABLE_FULLSCREEN&&screenfull.isEnabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oSelectPlayers&&s_oSelectPlayers.resetFullscreenBut())}function CSpriteLibrary(){var e,t,n,i,a,r,s={};this.init=function(s,o,l){e={},n=t=0,i=s,a=o,r=l},this.addSprite=function(n,i){if(!s.hasOwnProperty(n)){var a=new Image;s[n]=e[n]={szPath:i,oSprite:a,bLoaded:!1},t++}},this.getSprite=function(e){return s.hasOwnProperty(e)?s[e].oSprite:null},this._onSpritesLoaded=function(){t=0,a.call(r)},this._onSpriteLoaded=function(){i.call(r),++n===t&&this._onSpritesLoaded()},this.loadSprites=function(){for(var t in e)e[t].oSprite.oSpriteLibrary=this,e[t].oSprite.szKey=t,e[t].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey),this.oSpriteLibrary._onSpriteLoaded(this.szKey)},e[t].oSprite.onerror=function(t){var n=t.currentTarget;setTimeout(function(){e[n.szKey].oSprite.src=e[n.szKey].szPath},500)},e[t].oSprite.src=e[t].szPath},this.setLoaded=function(e){s[e].bLoaded=!0},this.isLoaded=function(e){return s[e].bLoaded},this.getNumSprites=function(){return t}}function CTextButton(e,t,n,i,a,r,s,o){var l,c,u,h,d,_,p,f,g,C,S,m;return this._init=function(e,t,n,i,a,r,s,o){l=!1,h=[],d=[],m=createBitmap(n),c=n.width,u=n.height;var _=Math.ceil(s/20),p=(C=new createjs.Text(i,s+"px "+a,"#000000")).getBounds();C.textAlign="center",C.lineWidth=.9*c,C.textBaseline="alphabetic",C.x=n.width/2+_,C.y=Math.floor(n.height/2)+p.height/3+_,(S=new createjs.Text(i,s+"px "+a,r)).textAlign="center",S.textBaseline="alphabetic",S.lineWidth=.9*c,S.x=n.width/2,S.y=Math.floor(n.height/2)+p.height/3,(g=new createjs.Container).x=e,g.y=t,g.regX=n.width/2,g.regY=n.height/2,s_bMobile||(g.cursor="pointer"),g.addChild(m,C,S),!1!==o&&s_oStage.addChild(g),this._initListener()},this.unload=function(){g.off("mousedown",p),g.off("pressup",f),s_oStage.removeChild(g)},this.setVisible=function(e){g.visible=e},this.setAlign=function(e){S.textAlign=e,C.textAlign=e},this.enable=function(){l=!1,m.filters=[],m.cache(0,0,c,u)},this.disable=function(){l=!0;var e=(new createjs.ColorMatrix).adjustSaturation(-100).adjustBrightness(40);m.filters=[new createjs.ColorMatrixFilter(e)],m.cache(0,0,c,u)},this._initListener=function(){p=g.on("mousedown",this.buttonDown),f=g.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,n){h[e]=t,d[e]=n},this.addEventListenerWithParams=function(e,t,n,i){h[e]=t,d[e]=n,_=i},this.buttonRelease=function(){l||(playSound("click",1,!1),g.scaleX=1,g.scaleY=1,h[ON_MOUSE_UP]&&h[ON_MOUSE_UP].call(d[ON_MOUSE_UP],_))},this.buttonDown=function(){l||(g.scaleX=.9,g.scaleY=.9,h[ON_MOUSE_DOWN]&&h[ON_MOUSE_DOWN].call(d[ON_MOUSE_DOWN]))},this.setPosition=function(e,t){g.x=e,g.y=t},this.changeText=function(e){S.text=e,C.text=e},this.setX=function(e){g.x=e},this.setY=function(e){g.y=e},this.getButtonImage=function(){return g},this.getX=function(){return g.x},this.getY=function(){return g.y},this.getSprite=function(){return g},this._init(e,t,n,i,a,r,s,o),this}function CToggle(e,t,n,i,a){var r,s,o,l,c,u;this._init=function(e,t,n,i,a){s=[],o=[];var l=new createjs.SpriteSheet({images:[n],frames:{width:n.width/2,height:n.height,regX:n.width/2/2,regY:n.height/2},animations:{state_true:[0],state_false:[1]}});(u=createSprite(l,"state_"+(r=i),n.width/2/2,n.height/2,n.width/2,n.height)).x=e,u.y=t,u.stop(),u.cursor="pointer",a.addChild(u),this._initListener()},this.unload=function(){u.off("mousedown",l),u.off("pressup",c),a.removeChild(u)},this._initListener=function(){l=u.on("mousedown",this.buttonDown),c=u.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,n){s[e]=t,o[e]=n},this.setActive=function(e){r=e,u.gotoAndStop("state_"+r)},this.buttonRelease=function(){u.scaleX=1,u.scaleY=1,playSound("click",1,!1),r=!r,u.gotoAndStop("state_"+r),s[ON_MOUSE_UP]&&s[ON_MOUSE_UP].call(o[ON_MOUSE_UP],r)},this.buttonDown=function(){u.scaleX=.9,u.scaleY=.9,s[ON_MOUSE_DOWN]&&s[ON_MOUSE_DOWN].call(o[ON_MOUSE_DOWN])},this.setPosition=function(e,t){u.x=e,u.y=t},this._init(e,t,n,i,a)}function CGfxButton(e,t,n,i){var a,r,s,o,l,c,u;return this._init=function(e,t,n,i){a=!1,r=1,s=[],o=[],(u=createBitmap(n)).x=e,u.y=t,u.scaleX=u.scaleY=r,u.regX=n.width/2,u.regY=n.height/2,u.cursor="pointer",i.addChild(u),this._initListener()},this.unload=function(){u.off("mousedown",l),u.off("pressup",c),i.removeChild(u)},this.setVisible=function(e){u.visible=e},this.setClickable=function(e){a=!e},this._initListener=function(){l=u.on("mousedown",this.buttonDown),c=u.on("pressup",this.buttonRelease)},this.addEventListener=function(e,t,n){s[e]=t,o[e]=n},this.buttonRelease=function(){a||(u.scaleX=r,u.scaleY=r,s[ON_MOUSE_UP]&&s[ON_MOUSE_UP].call(o[ON_MOUSE_UP]))},this.buttonDown=function(){a||(u.scaleX=.9*r,u.scaleY=.9*r,playSound("click",1,!1),s[ON_MOUSE_DOWN]&&s[ON_MOUSE_DOWN].call(o[ON_MOUSE_DOWN]))},this.pulseAnimation=function(){createjs.Tween.get(u,{loop:!0}).to({scaleX:.9*r,scaleY:.9*r},850,createjs.Ease.quadOut).to({scaleX:r,scaleY:r},650,createjs.Ease.quadIn)},this.trembleAnimation=function(){createjs.Tween.get(u,{loop:!0}).to({rotation:10},75,createjs.Ease.quadOut).to({rotation:-10},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn)},this.removeAnimation=function(){u.scale=r,u.rotation=0,createjs.Tween.removeTweens(u)},this.setPosition=function(e,t){u.x=e,u.y=t},this.setX=function(e){u.x=e},this.setY=function(e){u.y=e},this.setImage=function(e){u.image=e},this.getButtonImage=function(){return u},this.getX=function(){return u.x},this.getY=function(){return u.y},this._init(e,t,n,i),this}function CTLText(e,t,n,i,a,r,s,o,l,c,u,h,d,_,p,f,g){this._oContainer=e,this._x=t,this._y=n,this._iWidth=i,this._iHeight=a,this._bMultiline=f,this._iFontSize=r,this._szAlign=s,this._szColor=o,this._szFont=l,this._iPaddingH=u,this._iPaddingV=h,this._bVerticalAlign=p,this._bFitText=_,this._bDebug=g,this._oDebugShape=null,this._fLineHeightFactor=c,this._oText=null,d&&this.__createText(d)}!function(e){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),$(window).resize(function(){sizeHandler()}),window.addEventListener("orientationchange",onOrientationChange),CircularList.prototype._getNextIndex=function(){var e=this.currentIndex;return e<this.arr.length-1?e+1:0},CircularList.prototype._getPrevIndex=function(){var e=this.currentIndex,t=this.arr;return 0<e?e-1:t.length-1},CircularList.prototype.getNext=function(){return this.arr[this._getNextIndex()]},CircularList.prototype.getPrev=function(){return this.arr[this._getPrevIndex()]},CircularList.prototype.next=function(){return this.currentIndex=this._getNextIndex(),this.current()},CircularList.prototype.prev=function(){return this.currentIndex=this._getPrevIndex(),this.current()},CircularList.prototype.current=function(){return this.arr[this.currentIndex]},CircularList.prototype.removeElement=function(e){-1<(e=this.arr.indexOf(e))&&this.arr.splice(e,1)},CircularList.prototype.getArray=function(){return this.arr},CircularList.prototype.setCurrent=function(e){return-1<(e=this.arr.indexOf(e))?(this.currentIndex=e,this.current()):null},NoClickDelay.prototype={handleEvent:function(e){switch(e.type){case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);break;case"touchend":this.onTouchEnd(e)}},onTouchStart:function(e){e.preventDefault(),this.moved=!1,this.element.addEventListener("touchmove",this,!1),this.element.addEventListener("touchend",this,!1)},onTouchMove:function(e){this.moved=!0},onTouchEnd:function(e){if(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1),!this.moved){3==(e=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)).nodeType&&(e=e.parentNode);var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),e.dispatchEvent(t)}}},function(){function e(e){var n={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};(e=e||window.event).type in n?document.body.className=n[e.type]:(document.body.className=this[t]?"hidden":"visible","hidden"===document.body.className?(s_oMain.stopUpdate(),s_bFocus=!1):(s_oMain.startUpdate(),s_bFocus=!0))}var t="hidden";t in document?document.addEventListener("visibilitychange",e):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(t="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?document.onfocusin=document.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e}(),screenfull.isEnabled&&screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oSelectPlayers&&s_oSelectPlayers.resetFullscreenBut()}),CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){for(var e=this._iFontSize;(this._oText.getBounds().height>this._iHeight-2*this._iPaddingV||this._oText.getBounds().width>this._iWidth-2*this._iPaddingH)&&(e--,this._oText.font=e+"px "+this._szFont,this._oText.lineHeight=Math.round(e*this._fLineHeightFactor),this.__updateY(),this.__verticalAlign(),!(8>e)););this._iFontSize=e}},__verticalAlign:function(){if(this._bVerticalAlign){var e=this._oText.getBounds().height;this._oText.y-=(e-this._iHeight)/2+this._iPaddingV}},__updateY:function(){switch(this._oText.y=this._y+this._iPaddingV,this._oText.textBaseline){case"middle":this._oText.y+=this._oText.lineHeight/2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__createText:function(e){switch(this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(0,0,this._iWidth,this._iHeight),this._oDebugShape.x=this._x,this._oDebugShape.y=this._y,this._oContainer.addChild(this._oDebugShape)),this._oText=new createjs.Text(e,this._iFontSize+"px "+this._szFont,this._szColor),this._oText.textBaseline="middle",this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor),this._oText.textAlign=this._szAlign,this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null,this._szAlign){case"center":this._oText.x=this._x+this._iWidth/2;break;case"left":this._oText.x=this._x+this._iPaddingH;break;case"right":this._oText.x=this._x+this._iWidth-this._iPaddingH}this._oContainer.addChild(this._oText),this.refreshText(e)},setVerticalAlign:function(e){this._bVerticalAlign=e},setOutline:function(e){null!==this._oText&&(this._oText.outline=e)},setShadow:function(e,t,n,i){null!==this._oText&&(this._oText.shadow=new createjs.Shadow(e,t,n,i))},setColor:function(e){this._oText.color=e},setAlpha:function(e){this._oText.alpha=e},setAlign:function(e){this._oText.textAlign=e},removeTweens:function(){createjs.Tween.removeTweens(this._oText)},getText:function(){return this._oText},getX:function(){return this._x},getY:function(){return this._y},getFontSize:function(){return this._iFontSize},setY:function(e){this._y=e,this._oText.y=this._y},setPos:function(e,t){if(this._x=e,this._y=t,this._oText.x=this._x,this._oText.y=this._y,this._bDebug){this._oContainer.removeChild(this._oDebugShape);var n="left"===this._oText.textAlign?0:-this._iWidth;this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(n,0,this._iWidth,this._iHeight),this._oDebugShape.x=this._x,this._oDebugShape.y=this._y,this._oContainer.addChild(this._oDebugShape)}this.__autofit(),this.__updateY(),this.__verticalAlign()},refreshText:function(e){""===e&&(e=" "),null===this._oText&&this.__createText(e),this._oText.text=e,this._oText.font=this._iFontSize+"px "+this._szFont,this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor),this.__autofit(),this.__updateY(),this.__verticalAlign()}},function(){function e(t){var a,r,s=t;if(i[s])s=i[s];else{for(var o,l=s,c=[],u=0;l;){if(null!==(o=n.text.exec(l)))c.push(o[0]);else if(null!==(o=n.modulo.exec(l)))c.push("%");else{if(null===(o=n.placeholder.exec(l)))throw new SyntaxError("[sprintf] unexpected placeholder");if(o[2]){u|=1;var h,d=[],_=o[2];if(null===(h=n.key.exec(_)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(d.push(h[1]);""!==(_=_.substring(h[0].length));)if(null!==(h=n.key_access.exec(_)))d.push(h[1]);else{if(null===(h=n.index_access.exec(_)))throw new SyntaxError("[sprintf] failed to parse named argument key");d.push(h[1])}o[2]=d}else u|=2;if(3===u)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");c.push({placeholder:o[0],param_no:o[1],keys:o[2],sign:o[3],pad_char:o[4],align:o[5],width:o[6],precision:o[7],type:o[8]})}l=l.substring(o[0].length)}s=i[s]=c}for(l=arguments,o=1,c=s.length,d="",_=0;_<c;_++)if("string"==typeof s[_])d+=s[_];else if("object"==typeof s[_]){if((h=s[_]).keys)for(u=l[o],a=0;a<h.keys.length;a++){if(null==u)throw Error(e('[sprintf] Cannot access property "%s" of undefined value "%s"',h.keys[a],h.keys[a-1]));u=u[h.keys[a]]}else u=h.param_no?l[h.param_no]:l[o++];if(n.not_type.test(h.type)&&n.not_primitive.test(h.type)&&u instanceof Function&&(u=u()),n.numeric_arg.test(h.type)&&"number"!=typeof u&&isNaN(u))throw new TypeError(e("[sprintf] expecting number but found %T",u));switch(n.number.test(h.type)&&(r=0<=u),h.type){case"b":u=parseInt(u,10).toString(2);break;case"c":u=String.fromCharCode(parseInt(u,10));break;case"d":case"i":u=parseInt(u,10);break;case"j":u=JSON.stringify(u,null,h.width?parseInt(h.width):0);break;case"e":u=h.precision?parseFloat(u).toExponential(h.precision):parseFloat(u).toExponential();break;case"f":u=h.precision?parseFloat(u).toFixed(h.precision):parseFloat(u);break;case"g":u=h.precision?String(Number(u.toPrecision(h.precision))):parseFloat(u);break;case"o":u=(parseInt(u,10)>>>0).toString(8);break;case"s":u=String(u),u=h.precision?u.substring(0,h.precision):u;break;case"t":u=String(!!u),u=h.precision?u.substring(0,h.precision):u;break;case"T":u=Object.prototype.toString.call(u).slice(8,-1).toLowerCase(),u=h.precision?u.substring(0,h.precision):u;break;case"u":u=parseInt(u,10)>>>0;break;case"v":u=u.valueOf(),u=h.precision?u.substring(0,h.precision):u;break;case"x":u=(parseInt(u,10)>>>0).toString(16);break;case"X":u=(parseInt(u,10)>>>0).toString(16).toUpperCase()}if(n.json.test(h.type))d+=u;else{if(!n.number.test(h.type)||r&&!h.sign)var p="";else p=r?"+":"-",u=u.toString().replace(n.sign,"");a=h.pad_char?"0"===h.pad_char?"0":h.pad_char.charAt(1):" ";var f=h.width-(p+u).length;f=h.width&&0<f?a.repeat(f):"",d+=h.align?p+u+f:"0"===a?p+f+u:f+p+u}}return d}function t(t,n){return e.apply(null,[t].concat(n||[]))}var n={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/},i=Object.create(null);"undefined"!=typeof exports&&(exports.sprintf=e,exports.vsprintf=t),"undefined"!=typeof window&&(window.sprintf=e,window.vsprintf=t,"function"==typeof define&&define.amd&&define(function(){return{sprintf:e,vsprintf:t}}))}();var ENABLE_CHECK_ORIENTATION,AD_SHOW_COUNTER,NUM_PLAYERS,STARTING_NUM_CARDS,CANVAS_WIDTH=1920,CANVAS_HEIGHT=1080,EDGEBOARD_X=256,EDGEBOARD_Y=84,PRIMARY_FONT="RoundedMplus1c",FPS=30,FPS_TIME=1e3/FPS,DISABLE_SOUND_MOBILE=!1,ENABLE_FULLSCREEN=!0,GAME_PLAYERIO_ID="four-colors-o2yb5hcxu2o4lkmfuuykw",GAME_NAME="four_colors",MULTIPLAYER_TEST_LOCAL=!0,COMBINED_PLAYERS_MODE=!1,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,STATE_SELECT_PLAYERS=4,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_CARD_DEALED=6,ON_HOME=7,ON_CHECK=8,ON_NEXT=9,CARD_WIDTH=156,CARD_HEIGHT=242,SOUNDTRACK_VOLUME_IN_GAME=.4,DEBUG_SHOW_CARDS=!1,CARD_SCORE=[0,1,2,3,4,5,6,7,8,9,20,20,20,50,50],NUM_PENALTY_CARDS=2,NUM_WILD_CARDS=4,GAME_SCORE_WIN=250,BOTTOM=0,TOP=1,LEFT=2,RIGHT=3,HAND_POS=[];HAND_POS.num_player_2=[{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2+350,side:BOTTOM},{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2-350,side:TOP}],HAND_POS.num_player_3=[{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2+350,side:BOTTOM},{x:CANVAS_WIDTH/2-650,y:CANVAS_HEIGHT/2-40,side:LEFT},{x:CANVAS_WIDTH/2+650,y:CANVAS_HEIGHT/2,side:RIGHT}],HAND_POS.num_player_4=[{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2+350,side:BOTTOM},{x:CANVAS_WIDTH/2-650,y:CANVAS_HEIGHT/2-40,side:LEFT},{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2-350,side:TOP},{x:CANVAS_WIDTH/2+650,y:CANVAS_HEIGHT/2-40,side:RIGHT}];var FOTOGRAM_COLOR=52,FOTOGRAM_DRAW_FOUR=53,ON_COLOR_SELECTED=0,ACTION_NEXT_TURN=0,ACTION_USE_CARD=1,ACTION_ON_SHUFFLECARDS=2,ACTION_ON_DRAWCARDS=3,ACTION_ON_UNO_CLICK=4,ACTION_SELECT_COLOR=5,ACTION_DRAW_FOUR=6,ACTION_BLOCK_TURN=7,ACTION_INVERT_TURN=8,ACTION_DRAW_TWO_COLORED=9,EFFECT_SELECT_COLOR=0,EFFECT_DRAW_FOUR=1,EFFECT_STOP=2,EFFECT_INVERT_TURN=3,EFFECT_DRAW_TWO_COLORED=4,EFFECT_NORMAL_CARD=5,ON_APPLY_EFFECT=0,ON_APPLY_PENALITY=1,ON_UNO_CLICK=2,DRAW_TYPE_NORMAL=0,DRAW_TYPE_PENALITY=1,DRAW_TYPE_DRAW2_COLORED=2,DRAW_TYPE_DRAW4=3;function CPreloader(){var e,t,n,i,a,r,s,o,l,c;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this),s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png"),s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg"),s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png"),s_oSpriteLibrary.loadSprites(),c=new createjs.Container,s_oStage.addChild(c)},this.unload=function(){c.removeAllChildren(),l.unload()},this._onImagesLoaded=function(){},this._onAllImagesLoaded=function(){this.attachSprites(),s_oMain.preloaderReady()},this.attachSprites=function(){var u=new createjs.Shape;u.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),c.addChild(u),u=s_oSpriteLibrary.getSprite("200x200"),(s=createBitmap(u)).regX=.5*u.width,s.regY=.5*u.height,s.x=CANVAS_WIDTH/2,s.y=CANVAS_HEIGHT/2-180,c.addChild(s),(o=new createjs.Shape).graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(s.x-100,s.y-100,200,200,10),c.addChild(o),s.mask=o,u=s_oSpriteLibrary.getSprite("progress_bar"),(i=createBitmap(u)).x=CANVAS_WIDTH/2-u.width/2,i.y=CANVAS_HEIGHT/2+50,c.addChild(i),e=u.width,t=u.height,(a=new createjs.Shape).graphics.beginFill("rgba(0,0,0,0.01)").drawRect(i.x,i.y,1,t),c.addChild(a),i.mask=a,(n=new createjs.Text("","30px "+PRIMARY_FONT,"#fff")).x=CANVAS_WIDTH/2,n.y=CANVAS_HEIGHT/2+100,n.textBaseline="alphabetic",n.textAlign="center",c.addChild(n),u=s_oSpriteLibrary.getSprite("but_start"),(l=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,u,TEXT_PRELOADER_CONTINUE,"Arial","#000","bold 50",c)).addEventListener(ON_MOUSE_UP,this._onButStartRelease,this),l.setVisible(!1),(r=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),c.addChild(r),createjs.Tween.get(r).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(r),c.removeChild(r)})},this._onButStartRelease=function(){s_oMain.onRemovePreloader()},this.refreshLoader=function(r){n.text=r+"%",100===r&&(s_oMain.onRemovePreloader(),n.visible=!1,i.visible=!1),a.graphics.clear(),r=Math.floor(r*e/100),a.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(i.x,i.y,r,t)},this._init()}function CMain(e){var t,n,i,a=0,r=0,s=STATE_LOADING;this.initContainer=function(){s_oCanvas=document.getElementById("canvas"),(s_oStage=new createjs.Stage(s_oCanvas)).preventSelection=!0,createjs.Touch.enable(s_oStage,!0),!1===(s_bMobile=isMobile())&&(s_oStage.enableMouseOver(FPS),$("body").on("contextmenu","#canvas",function(e){return!1})),s_iPrevTime=(new Date).getTime(),createjs.Ticker.addEventListener("tick",this._update),createjs.Ticker.framerate=FPS,navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0),s_oSpriteLibrary=new CSpriteLibrary,n=new CPreloader},this.preloaderReady=function(){this._loadImages(),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds(),t=!0},this.soundLoaded=function(){a++,n.refreshLoader(Math.floor(a/r*100))},this._initSounds=function(){Howler.mute(!s_bAudioActive),(s_aSoundsInfo=[]).push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"}),s_aSoundsInfo.push({path:"./sounds/",filename:"click",loop:!1,volume:1,ingamename:"click"}),s_aSoundsInfo.push({path:"./sounds/",filename:"game_over",loop:!1,volume:1,ingamename:"game_over"}),s_aSoundsInfo.push({path:"./sounds/",filename:"card_dealing",loop:!1,volume:1,ingamename:"card_dealing"}),s_aSoundsInfo.push({path:"./sounds/",filename:"snap",loop:!1,volume:1,ingamename:"snap"}),s_aSoundsInfo.push({path:"./sounds/",filename:"card",loop:!1,volume:1,ingamename:"card"}),s_aSoundsInfo.push({path:"./sounds/",filename:"special_card",loop:!1,volume:1,ingamename:"special_card"}),s_aSoundsInfo.push({path:"./sounds/",filename:"change_color",loop:!1,volume:1,ingamename:"change_color"}),r+=s_aSoundsInfo.length,s_aSounds=[];for(var e=0;e<s_aSoundsInfo.length;e++)this.tryToLoadSound(s_aSoundsInfo[e],!1)},this.tryToLoadSound=function(e,t){setTimeout(function(){s_aSounds[e.ingamename]=new Howl({src:[e.path+e.filename+".mp3"],autoplay:!1,preload:!0,loop:e.loop,volume:e.volume,onload:s_oMain.soundLoaded,onloaderror:function(e,t){for(var n=0;n<s_aSoundsInfo.length;n++)if(e===s_aSounds[s_aSoundsInfo[n].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[n],!0);break}},onplayerror:function(e){for(var t=0;t<s_aSoundsInfo.length;t++)if(e===s_aSounds[s_aSoundsInfo[t].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[t].ingamename].once("unlock",function(){s_aSounds[s_aSoundsInfo[t].ingamename].play(),"soundtrack"===s_aSoundsInfo[t].ingamename&&null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)});break}}})},t?200:0)},this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this),s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png"),s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png"),s_oSpriteLibrary.addSprite("credits_panel","./sprites/credits_panel.png"),s_oSpriteLibrary.addSprite("select_color_panel","./sprites/select_color_panel.png"),s_oSpriteLibrary.addSprite("ctl_logo","./sprites/ctl_logo.png"),s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png"),s_oSpriteLibrary.addSprite("but_yes_big","./sprites/but_yes_big.png"),s_oSpriteLibrary.addSprite("but_exit_big","./sprites/but_exit_big.png"),s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png"),s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png"),s_oSpriteLibrary.addSprite("but_uno","./sprites/but_uno.png"),s_oSpriteLibrary.addSprite("but_p2","./sprites/but_p2.png"),s_oSpriteLibrary.addSprite("but_p3","./sprites/but_p3.png"),s_oSpriteLibrary.addSprite("but_p4","./sprites/but_p4.png"),s_oSpriteLibrary.addSprite("but_red","./sprites/_oButRed.png"),s_oSpriteLibrary.addSprite("but_green","./sprites/_oButGreen.png"),s_oSpriteLibrary.addSprite("but_blue","./sprites/_oButBlue.png"),s_oSpriteLibrary.addSprite("but_yellow","./sprites/_oButYellow.png"),s_oSpriteLibrary.addSprite("stop_turn","./sprites/stop_turn.png"),s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg"),s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg"),s_oSpriteLibrary.addSprite("bg_select_players","./sprites/bg_select_players.jpg"),s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png"),s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png"),s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png"),s_oSpriteLibrary.addSprite("but_arrow","./sprites/arrow.png"),s_oSpriteLibrary.addSprite("but_skip","./sprites/but_skip.png"),s_oSpriteLibrary.addSprite("line_player","./sprites/line_players.png"),s_oSpriteLibrary.addSprite("cards","./sprites/cards.png"),s_oSpriteLibrary.addSprite("colors","./sprites/colors.png"),s_oSpriteLibrary.addSprite("draw_four_anim","./sprites/draw_4.png"),s_oSpriteLibrary.addSprite("draw_two_anim","./sprites/draw_2.png"),s_oSpriteLibrary.addSprite("stop_turn_anim","./sprites/stop_turn.png"),s_oSpriteLibrary.addSprite("clock_wise_anim","./sprites/change_clockwise.png"),s_oSpriteLibrary.addSprite("change_color","./sprites/change_color.png"),s_oSpriteLibrary.addSprite("cloud_uno","./sprites/cloud.png"),s_oSpriteLibrary.addSprite("finger","./sprites/finger.png"),s_oSpriteLibrary.addSprite("shuffle_anim","./sprites/shuffle_anim.png"),s_oSpriteLibrary.addSprite("but_next","./sprites/but_next.png"),s_oSpriteLibrary.addSprite("but_show","./sprites/but_show.png"),s_oSpriteLibrary.addSprite("score_icon","./sprites/score_icon.png"),s_oSpriteLibrary.addSprite("info_label","./sprites/info_label.png"),s_oSpriteLibrary.addSprite("cup_icon","./sprites/cup_icon.png"),r+=s_oSpriteLibrary.getNumSprites(),s_oSpriteLibrary.loadSprites()},this._onImagesLoaded=function(){a++,n.refreshLoader(Math.floor(a/r*100))},this._onAllImagesLoaded=function(){},this.onRemovePreloader=function(){n.unload(),s_oSoundtrack=playSound("soundtrack",1,!0),this.gotoMenu()},this.gotoMenu=function(){new CMenu,s=STATE_MENU},this.gotoSelectPlayers=function(){new CSelectPlayers,s=STATE_SELECT_PLAYERS},this.gotoGame=function(){s_oGame=i=new CGameSingle(o),s=STATE_GAME},this.gotoHelp=function(){new CHelp,s=STATE_HELP},this.stopUpdate=function(){t=!1,createjs.Ticker.paused=!0,$("#block_game").css("display","block"),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)},this.startUpdate=function(){s_iPrevTime=(new Date).getTime(),t=!0,createjs.Ticker.paused=!1,$("#block_game").css("display","none"),(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)},this._update=function(e){if(!1!==t){var n=(new Date).getTime();s_iTimeElaps=n-s_iPrevTime,s_iCntFps++,s_iPrevTime=n,1e3<=(s_iCntTime+=s_iTimeElaps)&&(s_iCurFps=s_iCntFps,s_iCntTime-=1e3,s_iCntFps=0),s===STATE_GAME&&i.update(),s_oStage.update(e)}},s_oMain=this;var o=e;ENABLE_CHECK_ORIENTATION=e.check_orientation,ENABLE_FULLSCREEN=e.fullscreen,STARTING_NUM_CARDS=e.starting_num_cards,s_bAudioActive=e.audio_enable_on_startup,this.initContainer()}var s_bMobile,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oCanvas,s_aSounds,s_aSoundsInfo,s_oGame,s_bAudioActive=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_bFullscreen=!1,s_oSoundtrack=null,s_bFirstGame=!0;function CPanelTutorial(){var e,t,n,i,a,r;this.init=function(){r=new createjs.Container,a=0,(e=new createjs.Container).x=CANVAS_WIDTH/2,e.y=CANVAS_HEIGHT/2,(t=new createBitmap(s_oSpriteLibrary.getSprite("msg_box"))).regX=398,t.regY=258.5,t.alpha=.8,e.addChild(t),s_oStage.addChild(e),(n=new CGfxButton(e.getBounds().width/2-50,0,s_oSpriteLibrary.getSprite("but_arrow"),e)).addEventListener(ON_MOUSE_DOWN,this.onButNext,this);var s=s_oSpriteLibrary.getSprite("but_arrow");(i=new CGfxButton(-(e.getBounds().width/2-50),0,s,e)).addEventListener(ON_MOUSE_DOWN,this.onButBack,this),i.getButtonImage().rotation=180,new CGfxButton(e.getBounds().width/2-53,e.getBounds().height/2-53,s_oSpriteLibrary.getSprite("but_skip"),e).addEventListener(ON_MOUSE_DOWN,this.onButSkip,this),this.loadPage(a)},this.loadPage=function(t){switch(t){case 0:i.setVisible(!1),new CTLText(r,-300,-200,600,50,50,"center","#fff",PRIMARY_FONT,1.2,0,0,TEXT_WELCOME,!0,!0,!0,!1),new CTLText(r,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL1,GAME_SCORE_WIN),!0,!0,!0,!1),(t=new CCard(-215,0,r,"card_1_7",0,0)).setAnimTutorial("tutorial"),e.addChild(r);break;case 1:i.setVisible(!0),new CTLText(r,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL2,CARD_SCORE[12]),!0,!0,!0,!1),(t=new CCard(-215,0,r,"card_0_12",0,0)).setAnimTutorial("draw2tutorial");break;case 2:new CTLText(r,-80,-105,300,210,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL3,CARD_SCORE[10]),!0,!0,!0,!1),(t=new CCard(-215,0,r,"card_1_7",0,0)).setAnimTutorial("stopTurnTutorial");break;case 3:new CTLText(r,-80,-105,300,210,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL4,CARD_SCORE[11]),!0,!0,!0,!1),(t=new CCard(-215,0,r,"card_1_7",0,0)).setAnimTutorial("changeClockWiseTutorial");break;case 4:new CTLText(r,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL5,CARD_SCORE[13]),!0,!0,!0,!1),(t=new CCard(-215,0,r,FOTOGRAM_COLOR,0,0)).instantShow();break;case 5:n.setVisible(!0),new CTLText(r,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL6,CARD_SCORE[14]),!0,!0,!0,!1),(t=new CCard(-215,0,r,FOTOGRAM_DRAW_FOUR,0,0)).instantShow();break;case 6:n.setVisible(!1),new CTLText(r,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL7,NUM_PENALTY_CARDS),!0,!0,!0,!1),(t=new createBitmap(s_oSpriteLibrary.getSprite("but_uno"))).regX=50,t.regY=50.5,t.x=-215,t.scaleX=1.5,t.scaleY=1.5,r.addChild(t)}},this.onButNext=function(){a++,r.removeAllChildren(),this.loadPage(a)},this.onButBack=function(){a--,r.removeAllChildren(),this.loadPage(a)},this.onButSkip=function(){s_oStage.removeChild(e),s_oGame._startGame()},this.init()}function CTurnManager(){var e,t,n,i,a;this.init=function(){e=!0;for(var r=[],s=0;s<NUM_PLAYERS;s++)r.push(s);a=new CircularList(r),i=a.current(),n=a.current(),t=a.getNext(),s_oTurnManager=this},this.changeClockWise=function(){e=!0!==e},this.nextTurn=function(){!0===e?(a.next(),n=a.current(),t=a.getNext()):(a.prev(),n=a.current(),t=a.getPrev())},this.prevTurn=function(){!0===e?(a.prev(),n=a.current(),t=a.getNext()):(a.next(),n=a.current(),t=a.getPrev())},this.setTurn=function(i){a.setCurrent(i),n=a.current(),t=!0===e?a.getNext():a.getPrev()},this.setFirstPlayerToBegin=function(){do{++i===NUM_PLAYERS&&(i=0)}while(null===a.setCurrent(i));this.setTurn(i)},this.getFirstPlayerToBegin=function(){return i},this.resetClockWise=function(){e=!0},this.resetFirstPlayer=function(){i=-1},this.getTurn=function(){return n},this.getNextPlayer=function(){return t},this.getClockWise=function(){return e},this.removePlayer=function(t){t===n?(e?this.prevTurn():this.nextTurn(),a.removeElement(t)):(a.removeElement(t),a.setCurrent(n))},this.init()}function CAnimation(){var e,t,n,i,a,r,s;this.init=function(){r=!1;var o=s_oSpriteLibrary.getSprite("draw_four_anim");o={images:[o],frames:{width:292,height:290,regX:146,regY:145},animations:{anim:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],next:"stop",speed:.8},reverse:{frames:[13,12,11,10,9,8,7,6,5,4,3,2,1,0],next:[0],speed:.8},stop:[13]}},o=new createjs.SpriteSheet(o),e=new createjs.Sprite(o,0),o={images:[o=s_oSpriteLibrary.getSprite("draw_two_anim")],frames:{width:292,height:322,regX:146,regY:161},animations:{anim:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],next:"stop",speed:.8},reverse:{frames:[13,12,11,10,9,8,7,6,5,4,3,2,1,0],next:[0],speed:.8},stop:[13]}},o=new createjs.SpriteSheet(o),t=new createjs.Sprite(o,0),o=s_oSpriteLibrary.getSprite("stop_turn_anim"),n=new createBitmap(o,292,300),o=s_oSpriteLibrary.getSprite("clock_wise_anim"),i=new createBitmap(o,292,300),o={images:[o=s_oSpriteLibrary.getSprite("change_color")],frames:{width:328,height:315,regX:164,regY:157.5},animations:{anim:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],next:"anim",speed:.8},stop:[16],color_0:{frames:[0,1,2,3,4,5,6],speed:.8},color_1:{frames:[0,1,2],speed:.8},color_2:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],speed:.8},color_3:{frames:[0,1,2,3,4,5,6,7,8,9,10],speed:.8}}},o=new createjs.SpriteSheet(o),a=new createjs.Sprite(o,0),o={images:[o=s_oSpriteLibrary.getSprite("shuffle_anim")],frames:{width:403,height:386,regX:201.5,regY:193},animations:{anim:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],next:"anim"},idle:[17]}},o=new createjs.SpriteSheet(o),s=new createjs.Sprite(o,"idle")},this.drawFourAnim=function(t,n,i,a){e.alpha=0,e.x=CANVAS_WIDTH/2,e.y=CANVAS_HEIGHT/2,e.scaleX=.01,e.scaleY=.01,s_oStage.addChild(e),e.stop(),playSound("special_card",.5,!1),new createjs.Tween.get(e).to({alpha:1,scaleX:1.4,scaleY:1.4},200,createjs.Ease.cubicOut).wait(200).call(function(){e.gotoAndPlay("anim")}).wait(1e3).call(function(){e.gotoAndPlay("reverse")}).wait(200).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(e),s_oGame.drawCardsTween(t,n,i,a)})},this.drawTwoAnim=function(e,n,i,a){t.alpha=0,t.x=CANVAS_WIDTH/2,t.y=CANVAS_HEIGHT/2,t.scaleX=.01,t.scaleY=.01,s_oStage.addChild(t),t.stop(),playSound("special_card",.5,!1),new createjs.Tween.get(t).to({alpha:1,scaleX:1.4,scaleY:1.4},200,createjs.Ease.cubicOut).wait(200).call(function(){t.gotoAndPlay("anim"),setVolume("special_card",.2)}).wait(1e3).call(function(){t.gotoAndPlay("reverse"),setVolume("special_card",.1)}).wait(200).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(t),s_oGame.drawCardsTween(e,n,i,a)})},this.stopTurn=function(){return new Promise(function(e,t){n.alpha=0,n.regX=146,n.regY=150,n.x=CANVAS_WIDTH/2,n.y=CANVAS_HEIGHT/2,n.scaleX=.01,n.scaleY=.01,s_oStage.addChild(n),playSound("game_over",1,!1),new createjs.Tween.get(n).to({alpha:1,scaleX:2,scaleY:2},200,createjs.Ease.cubicOut).to({scaleX:1.6,scaleY:1.6},200).to({scaleX:2,scaleY:2},200).to({scaleX:1.6,scaleY:1.6},200).to({scaleX:2,scaleY:2},200).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(n),e()})})},this.changeClockWise=function(e){return new Promise(function(t,n){i.alpha=0,i.rotation=0,i.regX=146,i.regY=150,i.x=CANVAS_WIDTH/2,i.y=CANVAS_HEIGHT/2,i.scaleX=.01,i.scaleY=.01,s_oStage.addChild(i),playSound("special_card",.5,!1),!1===e?new createjs.Tween.get(i).to({alpha:1,scaleX:2,scaleY:2},200,createjs.Ease.cubicOut).to({rotation:360},500).wait(500).to({rotation:-360},500).wait(500).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(i),t()}):new createjs.Tween.get(i).to({alpha:1,scaleX:2,scaleY:2},200,createjs.Ease.cubicOut).to({rotation:-360},500).wait(500).to({rotation:360},500).wait(500).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(i),t()})})},this.changeColor=function(e){return new Promise(function(t,n){a.alpha=0,a.x=CANVAS_WIDTH/2,a.y=CANVAS_HEIGHT/2,a.scaleX=.01,a.scaleY=.01,s_oStage.addChild(a),a.stop(),playSound("change_color",.5,!1),new createjs.Tween.get(a).to({alpha:1,scaleX:1.4,scaleY:1.4},200,createjs.Ease.cubicOut).call(function(){a.gotoAndPlay("anim")}).wait(1300).call(function(){r=!0,a.on("animationend",s_oCAnimation.endAnimation,s_oCAnimation,!1,t),a.gotoAndStop(16),a.gotoAndPlay("color_"+e)})})},this.endAnimation=function(e,t){!0===r&&(stopSound("change_color"),playSound("special_card",1,!1),r=!1,a.removeAllEventListeners(),a.stop(),new createjs.Tween.get(a).to({scaleX:2,scaleY:2},250).to({scaleX:1.4,scaleY:1.4},250).to({scaleX:2,scaleY:2},250).to({scaleX:1.4,scaleY:1.4},250).to({alpha:0,scaleX:.1,scaleY:.1},200,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(a),a.gotoAndStop(0),t()}))},this.shuffleAnimation=function(){return new Promise(function(e,t){s.alpha=0,s.x=CANVAS_WIDTH/2,s.y=CANVAS_HEIGHT/2,s.scaleX=.01,s.scaleY=.01,s_oStage.addChild(s),s.stop(),new createjs.Tween.get(s).to({alpha:1,scaleX:1.6,scaleY:1.6},400,createjs.Ease.cubicOut).call(function(){s.gotoAndPlay("anim"),playSound("card_dealing",1,!0)}).wait(1700).call(function(){s.gotoAndStop("idle"),stopSound("change_color")}).to({alpha:0,scaleX:.01,scaleY:.01},300,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(s),stopSound("card_dealing"),e()})})},this.init(),s_oCAnimation=this}function CMenu(){var e,t,n,i,a,r,s,o,l,c,u,h,d=null,_=null;this._init=function(){s=createBitmap(s_oSpriteLibrary.getSprite("bg_menu")),s_oStage.addChild(s);var p=s_oSpriteLibrary.getSprite("but_play");(o=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-200,p,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this),p=s_oSpriteLibrary.getSprite("but_info"),a=p.width/2+10,r=p.height/2+10,(u=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-240,p,s_oStage)).addEventListener(ON_MOUSE_UP,this._onCreditsBut,this),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(p=s_oSpriteLibrary.getSprite("audio_icon"),n=CANVAS_WIDTH-p.height/2-10,i=p.height/2+10,(c=new CToggle(n,i,p,s_bAudioActive,s_oStage)).addEventListener(ON_MOUSE_UP,this._onAudioToggle,this));var f=(p=window.document).documentElement;d=f.requestFullscreen||f.mozRequestFullScreen||f.webkitRequestFullScreen||f.msRequestFullscreen,_=p.exitFullscreen||p.mozCancelFullScreen||p.webkitExitFullscreen||p.msExitFullscreen,!1===ENABLE_FULLSCREEN&&(d=!1),d&&screenfull.isEnabled&&(p=s_oSpriteLibrary.getSprite("but_fullscreen"),e=a+p.width/2+10,(h=new CToggle(e,t=r,p,s_bFullscreen,s_oStage)).addEventListener(ON_MOUSE_UP,this._onFullscreen,this)),(l=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),s_oStage.addChild(l),createjs.Tween.get(l).to({alpha:0},1e3).call(function(){l.visible=!1}),null!==s_oSoundtrack&&setVolume("soundtrack",1),this.refreshButtonPos()},this.unload=function(){o.unload(),o=null,l.visible=!1,u.unload(),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(c.unload(),c=null),d&&screenfull.isEnabled&&h.unload(),s_oStage.removeAllChildren(),s_oMenu=null},this.refreshButtonPos=function(){u.setPosition(a+s_iOffsetX,s_iOffsetY+r),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||c.setPosition(n-s_iOffsetX,s_iOffsetY+i),d&&screenfull.isEnabled&&h.setPosition(e+s_iOffsetX,t+s_iOffsetY)},this.resetFullscreenBut=function(){d&&screenfull.isEnabled&&h.setActive(s_bFullscreen)},this._onFullscreen=function(){s_bFullscreen?_.call(window.document):d.call(window.document.documentElement),sizeHandler()},this._onAudioToggle=function(){Howler.mute(s_bAudioActive),s_bAudioActive=!s_bAudioActive},this._onCreditsBut=function(){new CCreditsPanel},this._onButPlayRelease=function(){this.unload(),$(s_oMain).trigger("start_session"),s_oMain.gotoSelectPlayers()},s_oMenu=this,this._init()}s_oTurnManager=null,s_oCAnimation=null;var s_oMenu=null;function CSelectPlayers(){var e,t,n,i,a,r,s,o,l,c,u,h,d=null,_=null;this._init=function(){var p=createBitmap(s_oSpriteLibrary.getSprite("bg_select_players"));s_oStage.addChild(p),p=s_oSpriteLibrary.getSprite("but_p2"),(s=new CGfxButton(CANVAS_WIDTH/2-450,CANVAS_HEIGHT-500,p,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButP2,this),p=s_oSpriteLibrary.getSprite("but_p3"),(o=new CGfxButton(CANVAS_WIDTH/2+10,CANVAS_HEIGHT-500,p,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButP3,this),p=s_oSpriteLibrary.getSprite("but_p4"),(l=new CGfxButton(CANVAS_WIDTH/2+450,CANVAS_HEIGHT-500,p,s_oStage)).addEventListener(ON_MOUSE_UP,this._onButP4,this),new CTLText(s_oStage,CANVAS_WIDTH/2-500,300,1e3,150,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SELECT_PLAYERS,!0,!0,!0,!1),p=s_oSpriteLibrary.getSprite("but_exit"),e=CANVAS_WIDTH-p.height/2-10,t=p.height/2+10,(h=new CGfxButton(e,t,p,s_oStage)).addEventListener(ON_MOUSE_UP,this._onExit,this),a=CANVAS_WIDTH-p.width/2-100,r=p.height/2+10,!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(p=s_oSpriteLibrary.getSprite("audio_icon"),(u=new CToggle(a,r,p,s_bAudioActive,s_oStage)).addEventListener(ON_MOUSE_UP,this._onAudioToggle,this));var f=(p=window.document).documentElement;d=f.requestFullscreen||f.mozRequestFullScreen||f.webkitRequestFullScreen||f.msRequestFullscreen,_=p.exitFullscreen||p.mozCancelFullScreen||p.webkitExitFullscreen||p.msExitFullscreen,!1===ENABLE_FULLSCREEN&&(d=!1),d&&screenfull.isEnabled&&(p=s_oSpriteLibrary.getSprite("but_fullscreen"),n=p.width/4+10,i=p.height/2+10,(c=new CToggle(n,i,p,s_bFullscreen,s_oStage)).addEventListener(ON_MOUSE_UP,this._onFullscreen,this)),this.refreshButtonPos()},this._onButP2=function(){NUM_PLAYERS=2,this.unload(),$(s_oMain).trigger("select_players",2),s_oMain.gotoGame()},this._onButP3=function(){NUM_PLAYERS=3,this.unload(),$(s_oMain).trigger("select_players",3),s_oMain.gotoGame()},this._onButP4=function(){NUM_PLAYERS=4,this.unload(),$(s_oMain).trigger("select_players",4),s_oMain.gotoGame()},this.unload=function(){h.unload(),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(u.unload(),u=null),d&&screenfull.isEnabled&&c.unload(),s.unload(),o.unload(),l.unload(),s_oStage.removeAllChildren(),s_oSelectPlayers=null},this.refreshButtonPos=function(){h.setPosition(e-s_iOffsetX,s_iOffsetY+t),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||u.setPosition(a-s_iOffsetX,s_iOffsetY+r),d&&screenfull.isEnabled&&c.setPosition(n+s_iOffsetX,i+s_iOffsetY)},this.resetFullscreenBut=function(){d&&screenfull.isEnabled&&c.setActive(s_bFullscreen)},this._onFullscreen=function(){s_bFullscreen?_.call(window.document):d.call(window.document.documentElement),sizeHandler()},this._onExit=function(){this.unload(),s_oMain.gotoMenu()},this._onAudioToggle=function(){Howler.mute(s_bAudioActive),s_bAudioActive=!s_bAudioActive},s_oSelectPlayers=this,this._init()}var s_oSelectPlayers=null;function CCard(e,t,n,i,a,r,s,o){var l,c,u,h,d,_,p,f,g,C,S,m,b;this._init=function(e,t,n,i,a,r,s,o){m=n,h=a,d=r,u=i,this.setEffect(i),l=!1,b=s,c=0===d||2===d?"red":"black",p=0,o&&(p=o),(S=new createjs.Container).x=e,S.y=t,S.rotation=p,m.addChild(S),e={images:[s_oSpriteLibrary.getSprite("cards")],frames:{width:CARD_WIDTH,height:CARD_HEIGHT,regX:CARD_WIDTH/2,regY:CARD_HEIGHT/2},animations:{card_0_0:[0],card_0_1:[1],card_0_2:[2],card_0_3:[3],card_0_4:[4],card_0_5:[5],card_0_6:[6],card_0_7:[7],card_0_8:[8],card_0_9:[9],card_0_10:[10],card_0_11:[11],card_0_12:[12],card_1_0:[13],card_1_1:[14],card_1_2:[15],card_1_3:[16],card_1_4:[17],card_1_5:[18],card_1_6:[19],card_1_7:[20],card_1_8:[21],card_1_9:[22],card_1_10:[23],card_1_11:[24],card_1_12:[25],card_2_0:[26],card_2_1:[27],card_2_2:[28],card_2_3:[29],card_2_4:[30],card_2_5:[31],card_2_6:[32],card_2_7:[33],card_2_8:[34],card_2_9:[35],card_2_10:[36],card_2_11:[37],card_2_12:[38],card_3_0:[39],card_3_1:[40],card_3_2:[41],card_3_3:[42],card_3_4:[43],card_3_5:[44],card_3_6:[45],card_3_7:[46],card_3_8:[47],card_3_9:[48],card_3_10:[49],card_3_11:[50],card_3_12:[51],color:[52],draw_four:[53],back:[54],tutorial:{frames:[20,5,47,31],speed:.1},draw2tutorial:{frames:[12,25,38,51],speed:.1},stopTurnTutorial:{frames:[10,23,36,49],speed:.1},changeClockWiseTutorial:{frames:[11,24,37,50],speed:.1}}},e=new createjs.SpriteSheet(e),(C=createSprite(e,"back",CARD_WIDTH/2,CARD_HEIGHT/2,CARD_WIDTH,CARD_HEIGHT)).stop(),S.addChild(C),C.on("mousedown",this._mouseDown),f=[],g=[]},this.getCardSprite=function(){return C},this.setEffect=function(e){switch(e){case 52:_=EFFECT_SELECT_COLOR;break;case 53:_=EFFECT_DRAW_FOUR;break;default:switch(h){case 10:_=EFFECT_STOP;break;case 11:_=EFFECT_INVERT_TURN;break;case 12:_=EFFECT_DRAW_TWO_COLORED;break;default:_=e===FOTOGRAM_COLOR?EFFECT_SELECT_COLOR:e===FOTOGRAM_DRAW_FOUR?EFFECT_DRAW_FOUR:EFFECT_NORMAL_CARD}}},this.setAnimTutorial=function(e){C.gotoAndPlay(e)},this.unload=function(){C.off("mousedown",this._mouseDown),m.removeChild(S)},this.unloadEvent=function(){C.off("mousedown",this._mouseDown)},this.saveInfo=function(){return{szFotogram:u,iRank:h,iSuit:d,bValue:!0}},this.instantShow=function(){C.gotoAndStop(u)},this.setValue=function(){C.gotoAndStop(u),playSound("card",1,!1),createjs.Tween.get(S).to({scaleX:1},200)},this.setActive=function(e){e?S.addChild(void 0):S.removeChild(void 0)},this.setVisible=function(e){S.visible=!0===e},this.onSetTurned=function(){l=!0},this.offSetTurned=function(){l=!1},this.moveCard=function(e,t,n,i,a){var r=this;createjs.Tween.get(S).wait(a).to({x:e,y:t,rotation:n},i,createjs.Ease.linear).call(function(){s_oGame.playedCard(r)})},this.moveCardFirstHand=function(e,t,n,i,a){var r=this;createjs.Tween.get(S).wait(a).to({x:e,y:t,rotation:n},i,createjs.Ease.cubicOut).call(function(){playSound("card_dealing",1,!1),s_oGame.onCardDealed(r)})},this.moveFirstLastCard=function(e,t,n,i){var a=this;createjs.Tween.get(S).wait(i).to({x:e,y:t},n,createjs.Ease.linear).call(function(){s_oGame.onFirstLastCardDealed(a)})},this.dispose=function(e,t,n,i,a){return new Promise(function(r,s){createjs.Tween.get(S).wait(a).to({x:e,y:t,rotation:n},i,createjs.Ease.linear).call(function(){r()})})},this.setOnTop=function(){m.addChildAt(S,m.numChildren)},this.stackAndDeactive=function(e,t,n){createjs.Tween.get(S).to({x:e,y:t},n,createjs.Ease.cubicOut)},this._mouseDown=function(e){!1!==l&&s_oGame.playCard(T,e)},this.showCard=function(e,t){var n=this;createjs.Tween.get(S).wait(e).to({scaleX:.1},200).call(function(){n.setValue(t)}).call(function(){})},this.showCardNoInput=function(e,t){var n=this;createjs.Tween.get(S).wait(e).to({scaleX:.1},200).call(function(){n.setValue(t)}).call(function(){l=!1})},this.hideCard=function(){var e=this;createjs.Tween.get(S).to({scaleX:.1},200).call(function(){e.setBack()})},this.jumpAnim=function(){var e=1e3*Math.random(),n=1e3*Math.random();createjs.Tween.get(S,{loop:!0}).wait(e).to({y:t-20},200,createjs.Ease.cubicOut).to({y:t},200,createjs.Ease.cubicIn).wait(n)},this.stopAllAnim=function(){S.y=t,createjs.Tween.removeTweens(S)},this.setPos=function(e,t){S.x=e,S.y=t},this.setBack=function(){l=!1,C.gotoAndStop("back");var e=this;createjs.Tween.get(S).to({scaleX:1},200).call(function(){e.cardHidden()})},this.cardHidden=function(){f[ON_CARD_HIDE]&&f[ON_CARD_HIDE].call(g[ON_CARD_HIDE],this)},this.getEffect=function(){return _},this.getRank=function(){return h},this.getSuit=function(){return d},this.getColor=function(){return c},this.getFotogram=function(){return u},this.getPos=function(){return{x:S.x,y:S.y}},this.getSprite=function(){return S},this.getLogicRect=function(){return new createjs.Rectangle(S.x-CARD_WIDTH/2,S.y-CARD_HEIGHT/2,CARD_WIDTH,CARD_HEIGHT)},this.getTurned=function(){return l},this.getGlobalToLocal=function(e,t){return C.globalToLocal(e/s_oStage.scaleX,t/s_oStage.scaleY)},this.getUniqueID=function(){return b},this.getRot=function(){return S.rotation};var T=this;this._init(e,t,n,i,a,r,s,o)}function CDeckDisplayer(e,t,n,i){var a,r,s,o,l,c,u;this._init=function(){if(l=n,a=[],(r=new createjs.Container).x=e,r.y=t,r.on("mousedown",this.onDraw,this),l.addChild(r),i){(o=new createjs.Container).x=e,o.y=t,o.visible=!1,l.addChild(o);var u=s_oSpriteLibrary.getSprite("finger"),h=u.width/5,d=u.height/2;u=new createjs.SpriteSheet({images:[u],frames:{width:h,height:d,regX:h/2,regY:d/2},animations:{idle:{frames:[0,1,2,3,4,5,6,7,8,9],speed:.9}}}),(c=createSprite(u,"idle",h/2,d/2,h,d)).scaleX=.5,c.scaleY=.5,c.x=-100,c.y=-100,o.addChild(c)}s=!1},this.initializeDeck=function(){for(var e,t,n=0,i=0;4>i;i++)for(var s=0;10>s;s++)t=13*i+(e=s),a.push(new CCard(0,0,r,t,e,i,n++,0));for(i=0;4>i;i++)for(s=0;9>s;s++)t=13*i+(e=s+1),a.push(new CCard(0,0,r,t,e,i,n++,0));for(i=0;4>i;i++)for(s=0;2>s;s++)a.push(new CCard(0,0,r,13*i+10,10,i,n++,0)),a.push(new CCard(0,0,r,13*i+11,11,i,n++,0)),a.push(new CCard(0,0,r,13*i+12,12,i,n++,0));for(i=0;4>i;i++)a.push(new CCard(0,0,r,FOTOGRAM_COLOR,13,4,n++,0)),a.push(new CCard(0,0,r,FOTOGRAM_DRAW_FOUR,14,4,n++,0))},this.initializeFromData=function(e){for(var t,n,i=0,s=0;s<e.length;s++){switch(e[s]){case FOTOGRAM_COLOR:t=13,n=4;break;case FOTOGRAM_DRAW_FOUR:t=14,n=4;break;default:t=e[s]%13,n=Math.floor(e[s]/13)}a.push(new CCard(0,0,r,e[s],t,n,i++))}},this.shuffle=function(){var e;for(e=a.length;e;e--){var t=Math.floor(Math.random()*e),n=a[e-1];a[e-1]=a[t],a[t]=n}},this.clearCards=function(){for(var e=0;e<a.length;e++)a[e].unload();a=[]},this.moveContainer=function(e,t,n,i){createjs.Tween.get(r).wait(i).to({x:e,y:t},n,createjs.Ease.linear)},this.takeFirstLastCard=function(){return a.pop()},this.takeLastCard=function(){return a.pop()},this.getLastCard=function(){return a[a.length-1]},this.getCardByIndex=function(e){return a[e]},this.removeCardByIndex=function(e){return a.splice(e,1)},this.pushCard=function(e){a.push(e)},this.getContainer=function(){return r},this.getLength=function(){return a.length},this.onDraw=function(){!1===s&&s_oGame.onDraw()},this.disableInputUsedCards=function(){a[a.length-1].offSetTurned()},this.disableInputDraw=function(){s=!0},this.enableInputDraw=function(){s=!1},this.getIndexChild=function(){return s_oStage.getChildIndex(r)},this.setChildDepth=function(e){s_oStage.addChildAt(r,e)},this.getGlobalPosition=function(){return{x:r.x,y:r.y}},this.setOnTop=function(){l.addChildAt(r,l.numChildren)},this.setHelp=function(){l.setChildIndex(o,l.numChildren-1),this.setPointer(!0),u=setTimeout(function(){o.visible=!0},5e3)},this.hideHelp=function(){clearTimeout(u),o.visible=!1,this.setPointer(!1)},this.setPointer=function(e){r.cursor=e?"pointer":"default"},this.addNewCardUnderTheDeck=function(e){for(var t=0;t<e.length;t++)a.push(e[t])},this.removeAllCardUnderTheDeck=function(){for(var e=[],t=0;t<a.length-1;t++)a[t].unload(),e.push(a.shift()),t--;return e},this._init()}function CHandDisplayer(e,t,n,i,a,r,s,o){var l,c,u,h,d,_,p,f,g,C,S,m,b;this.init=function(){l=!1,m=s,S=0,b=a,d=[],_=new createjs.Container,(C=r).addChild(_),p=new CPlayerInfo(n,i,C,s),(f=new CInfoLabel(n,i,C)).setVisible(!1);var c={images:[s_oSpriteLibrary.getSprite("cloud_uno")],frames:{width:261,height:194,regX:130.5,regY:97},animations:{cloud1:[0],cloud2:[1]}};c=new createjs.SpriteSheet(c),(g=new createjs.Sprite(c,"cloud1")).alpha=0,g.scaleX=.1,g.scaleY=.1,this.setPosition(e,t,n,i,o)},this.setPosition=function(e,t,n,i,a){switch(c=e,u=t,_.x=n,_.y=i,h=a,f.setPosition(_.x,_.y,h),h){case BOTTOM:var r=_.x,s=_.y-140;break;case TOP:c=-e,r=_.x,s=_.y+140;break;case LEFT:r=_.x+140,s=_.y,f.setPosition(_.x+20,_.y,h);break;case RIGHT:u=-t,r=_.x-140,s=_.y,f.setPosition(_.x-20,_.y,h)}p.setPosition(r,s,h)},this.clearCards=function(){for(var e=0;e<d.length;e++)d[e].unload();d=[]},this.getGlobalPosition=function(){for(var e=0,t=0,n=0;n<d.length;n++)0!==c?e+=CARD_WIDTH/2:t+=CARD_HEIGHT/2;return{x:_.x+e,y:_.y+t}},this.getContainerPos=function(){return{x:_.x,y:_.y}},this.getCardPositionByIndex=function(e){return{x:(e=d[e].getPos()).x,y:e.y}},this.searchIndexCard=function(e){for(var t=0;t<d.length;t++)if(e===d[t])return t},this.removeCardByIndex=function(e){return d.splice(e,1)},this.getPosNewCard=function(){var e=this.getDynamicOffset(c),t=this.getDynamicOffset(u);return{x:d.length*e,y:d.length*t}},this.pushCard=function(e){d.push(e),0===u&&_.y>CANVAS_HEIGHT/2&&d[d.length-1].getCardSprite().on("mouseover",this.onMouseOver)},this.getContainer=function(){return _},this.getLastCard=function(){return d[d.length-1]},this.getLength=function(){return d.length},this.centerContainer=function(){var e=_.getBounds(),t=-e.width/2+CARD_WIDTH/2;h===TOP&&(t=e.width/2-CARD_WIDTH/2);var n=-e.height/2+CARD_WIDTH/2;h===RIGHT&&(n=e.height/2-CARD_WIDTH/2),0!==c?createjs.Tween.get(_).to({x:CANVAS_WIDTH/2+t},300,createjs.Ease.linear):createjs.Tween.get(_).to({y:CANVAS_HEIGHT/2+n-40},300,createjs.Ease.linear)},this.setOnTop=function(){C.addChildAt(_,C.numChildren)},this.setChildDepth=function(e){e>_.s_oStage.numChild-1&&(e=_.s_oStage.numChild-1),s_oStage.addChildAt(e)},this.getContainerInfo=function(){return _.getBounds()},this.getCardByIndex=function(e){return d[e]},this.organizeHand=function(e){var t=this;if(0!==c)for(e=0;e<d.length;e++){var n=this.getDynamicOffset(c);n*=e,createjs.Tween.get(d[e].getSprite()).to({x:n},300,createjs.Ease.linear).call(t.centerContainer)}else for(e=0;e<d.length;e++)n=this.getDynamicOffset(u),n*=e,createjs.Tween.get(d[e].getSprite()).to({y:n},300,createjs.Ease.linear).call(function(){t.centerContainer()})},this.getDynamicOffset=function(e){var t=e;return 6<d.length&&(t=linearFunction(d.length,7,20,e,.55*e)),t},this.setOnTurn=function(){p.highlight()},this.setOffTurn=function(){p.disable()},this.checkUno=function(){1===d.length&&(this.setOnTop(),0!==c?_.y<CANVAS_HEIGHT/2?(g.gotoAndStop("cloud2"),g.x=CANVAS_WIDTH/2-270,g.y=CANVAS_HEIGHT/2-300):(g.gotoAndStop("cloud1"),g.x=CANVAS_WIDTH/2+300,g.y=CANVAS_HEIGHT/2+100):_.x<CANVAS_WIDTH/2?(g.gotoAndStop("cloud1"),g.x=CANVAS_WIDTH/2-350,g.y=CANVAS_HEIGHT/2-30):(g.gotoAndStop("cloud2"),g.x=CANVAS_WIDTH/2+350,g.y=CANVAS_HEIGHT/2-200),s_oStage.addChild(g),new createjs.Tween.get(g).to({alpha:1,scaleX:1,scaleY:1},300,createjs.Ease.bounceOut).wait(1500).to({scaleX:.1,scaleY:.1},300,createjs.Ease.cubicIn).to({alpha:0},20).call(function(){s_oStage.removeChild(g)}))},this.onMouseOver=function(e){s_bMobile||(e.target.cursor="pointer")},this.showAllCards=function(){for(var e=0;e<d.length;e++)d[e].showCard()},this.changeName=function(e){m=e,p.setName(e)},this.refreshScore=function(){p.setScore(S),f.setVisible(!1)},this.getCardByUniqueID=function(e){for(var t=0;t<d.length;t++)if(d[t].getUniqueID()===e)return d[t]},this.getPlayerID=function(){return b},this.getName=function(){return m},this.getSide=function(){return h},this.getScore=function(){return S},this.setScore=function(e){S=e},this.showHandScore=function(e){f.setVisible(!0),f.setTextScore(e),f.setOnTop()},this.hideMsgBox=function(){f.setVisible(!1),f.setTextScore("")},this.calculateHandScore=function(){for(var e=0,t=0;t<d.length;t++){var n=d[t].getRank();e+=CARD_SCORE[n]}return e},this.getAllCards=function(){return d},this.stopAllAnim=function(){for(var e=0;e<d.length;e++)d[e].stopAllAnim()},this.dispose=function(e,t){var n=this;l=!0;for(var i=d.length,a=0;a<d.length;a++)d[a].dispose(e,t,0,400,0).then(function(){0===--i&&n.clearCards()});this.showHandScore(TEXT_PLAYER_QUIT),f.stopAnim()},this.isDisposed=function(){return l},this.init()}function CGameBase(e){this._iCounterDraw,this._oInterface,this._oParent,this._oDeck,this._aPlayersHand,this._oUsedCards,this._oTurnManager,this._iCurrentColor,this._bUNO,this._bEndGame,this._oAnimation,this._iCurPlayer,this._iNextPlayer,this._oFinger,this._oFade,this._oDecksContainer,this._oHandsContainer,this._oCardsContainer,this._oAIManager,this._oUnoController,this._oSummaryPanel,this._init()}function CGameSingle(e){CGameBase.call(this,e),!0===s_bFirstGame?new CPanelTutorial:this._startGame()}function CInterface(){var e,t,n,i,a,r,s,o,l,c,u,h,d,_=null,p=null;return this._init=function(){d=new createjs.Container;var f=s_oSpriteLibrary.getSprite("but_exit");a=CANVAS_WIDTH-f.height/2-10,r=f.height/2+10,(c=new CGfxButton(a,r,f,d)).addEventListener(ON_MOUSE_UP,this._onExit,this),n=CANVAS_WIDTH-f.width/2-100,i=f.height/2+10,!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(f=s_oSpriteLibrary.getSprite("audio_icon"),(l=new CToggle(n,i,f,s_bAudioActive,d)).addEventListener(ON_MOUSE_UP,this._onAudioToggle,this));var g=(f=window.document).documentElement;_=g.requestFullscreen||g.mozRequestFullScreen||g.webkitRequestFullScreen||g.msRequestFullscreen,p=f.exitFullscreen||f.mozCancelFullScreen||f.webkitExitFullscreen||f.msExitFullscreen,!1===ENABLE_FULLSCREEN&&(_=!1),_&&screenfull.isEnabled&&(f=s_oSpriteLibrary.getSprite("but_fullscreen"),e=f.width/4+10,t=f.height/2+10,(u=new CToggle(e,t,f,s_bFullscreen,d)).addEventListener(ON_MOUSE_UP,this._onFullscreen,this)),f=s_oSpriteLibrary.getSprite("colors"),f=new createjs.SpriteSheet({images:[f],frames:{width:103,height:102,regX:51.5,regY:51},animations:{red:[0],green:[1],blue:[2],yellow:[3]}}),s=CANVAS_WIDTH/2+220,o=CANVAS_HEIGHT/2-60,(h=new createjs.Sprite(f,0)).stop(),h.x=s,h.y=o,s_oStage.addChild(d),this.refreshButtonPos()},this.refreshColor=function(e){h.gotoAndStop(e),s_oStage.addChildAt(h,1)},this.unload=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||(l.unload(),l=null),c.unload(),_&&screenfull.isEnabled&&u.unload(),s_oInterface=null},this.refreshButtonPos=function(){c.setPosition(a-s_iOffsetX,s_iOffsetY+r),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.setPosition(n-s_iOffsetX,s_iOffsetY+i),_&&screenfull.isEnabled&&u.setPosition(e+s_iOffsetX,t+s_iOffsetY)},this.setOnTop=function(){s_oStage.addChildAt(d,s_oStage.numChildren)},this._onAudioToggle=function(){Howler.mute(s_bAudioActive),s_bAudioActive=!s_bAudioActive},this._onExit=function(){new CAreYouSurePanel(s_oGame.onExit)},this._onRestart=function(){s_oGame.restart()},this.resetFullscreenBut=function(){_&&screenfull.isEnabled&&u.setActive(s_bFullscreen)},this._onFullscreen=function(){s_bFullscreen?p.call(window.document):_.call(window.document.documentElement),sizeHandler()},s_oInterface=this,this._init(),this}CGameBase.prototype._init=function(){this._bEndGame=this._bUNO=!1,this._iCounterDraw=0,this._oTurnManager=new CTurnManager,this._oAnimation=new CAnimation;var e=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));s_oStage.addChild(e),this._oUnoController=new CUnoController,this._oInterface=new CInterface,this._oCardsContainer=new createjs.Container,this._oHandsContainer=new createjs.Container,this._oPanelContainer=new createjs.Container,this._oDecksContainer=new createjs.Container,(e=[])[0]=TEXT_PLAYER_1,e[1]=TEXT_PLAYER_2,e[2]=TEXT_PLAYER_3,e[3]=TEXT_PLAYER_4,this._aPlayersHand=[];for(var t=0;t<NUM_PLAYERS;t++){var n=0,i=0;HAND_POS["num_player_"+NUM_PLAYERS][t].x===CANVAS_WIDTH/2?n=CARD_WIDTH/2:i=CARD_HEIGHT/4,this._aPlayersHand[t]=new CHandDisplayer(n,i,HAND_POS["num_player_"+NUM_PLAYERS][t].x,HAND_POS["num_player_"+NUM_PLAYERS][t].y,t,this._oHandsContainer,e[t],HAND_POS["num_player_"+NUM_PLAYERS][t].side)}this._oCardsContainer.addChild(this._oDecksContainer),this._oCardsContainer.addChild(this._oHandsContainer),s_oStage.addChild(this._oCardsContainer),s_oStage.addChild(this._oPanelContainer),this._oSummaryPanel=new CSummaryPanel(this._oPanelContainer),this._oSummaryPanel.addEventListener(ON_CHECK,this._onCheck,this),this._oMsgBox=new CMsgBox(this._oPanelContainer),this._oDeck=new CDeckDisplayer(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,this._oDecksContainer,!0),this._oUsedCards=new CDeckDisplayer(CANVAS_WIDTH/2+CARD_WIDTH,CANVAS_HEIGHT/2,this._oDecksContainer,!1),this._oUsedCards.disableInputDraw(),this.setOffTurn(),this._oAIManager=new CAIManager,setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)},CGameBase.prototype.reset=function(){this._iCounterDraw=0,this._oTurnManager.setFirstPlayerToBegin(),this._oTurnManager.resetClockWise(),this._oDeck.clearCards(),this._oUsedCards.clearCards(),this._oUsedCards.disableInputDraw();for(var e=0;e<this._aPlayersHand.length;e++)this._aPlayersHand[e].clearCards(),this._aPlayersHand[e].refreshScore();this._oSummaryPanel.reset(),this.setOffTurn()},CGameBase.prototype.getFirstHand=function(){var e=this._oDeck.takeLastCard(),t=this._oTurnManager.getTurn(),n=this._aPlayersHand[t].getContainerPos(),i=this._aPlayersHand[t].getPosNewCard(),a=this._oDeck.getGlobalPosition();e.setOnTop(),this._oCardsContainer.addChildAt(this._oDecksContainer,this._oCardsContainer.numChildren),this._oDeck.setOnTop(),t=this._getCardRotation(t),e.moveCardFirstHand(n.x+i.x-a.x,n.y+i.y-a.y,t,250)},CGameBase.prototype.onCardDealed=function(e){var t=this._oTurnManager.getTurn(),n=this._getCardRotation(t);this._aPlayersHand[t].pushCard(new CCard(this._aPlayersHand[t].getPosNewCard().x,this._aPlayersHand[t].getPosNewCard().y,this._aPlayersHand[t].getContainer(),e.getFotogram(),e.getRank(),e.getSuit(),e.getUniqueID(),n)),e.unload(),e=this._aPlayersHand[t].getLastCard(),this._aPlayersHand[t].centerContainer(),this.canCardBeShown(t)&&e.showCard(),this._oTurnManager.nextTurn(),this.matchCanStart()?(this._oCardsContainer.addChildAt(this._oDecksContainer,this._oCardsContainer),this._oDeck.setOnTop(),(e=this._oDeck.takeFirstLastCard()).moveFirstLastCard(CARD_WIDTH,0,600)):this.getFirstHand()},CGameBase.prototype.onFirstLastCardDealed=function(e){this._oUsedCards.pushCard(new CCard(0,0,this._oUsedCards.getContainer(),e.getFotogram(),e.getRank(),e.getSuit(),e.getUniqueID(),0)),e.unload(),this._oUsedCards.getLastCard().showCardNoInput(),this._oDeck.moveContainer(CANVAS_WIDTH/2-CARD_WIDTH/2,CANVAS_HEIGHT/2,400),this._oUsedCards.moveContainer(CANVAS_WIDTH/2+CARD_WIDTH/2,CANVAS_HEIGHT/2,400),this._iCurrentColor=this._oUsedCards.getLastCard().getSuit(),this._oInterface.refreshColor(this._iCurrentColor),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._aPlayersHand[this._iCurPlayer].setOnTurn(),this._oUsedCards.disableInputUsedCards(),this._onFirstTurnStart()},CGameBase.prototype._onFirstTurnStart=function(){this._oTurnManager.prevTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this.setOffTurn();var e=this._oUsedCards.getLastCard();this._checkFirstCardEffect(e.getEffect())},CGameBase.prototype.cpuPlayCard=function(e){var t=this._iCurPlayer,n=this._aPlayersHand[t].getContainerPos(),i=this._oUsedCards.getGlobalPosition();this._oCardsContainer.addChildAt(this._oHandsContainer,this._oCardsContainer.numChildren),this._aPlayersHand[t].setOnTop(),e.moveCard(i.x-n.x,i.y-n.y,0,400,1e3),this._oDeck.setChildDepth(2),this._oUsedCards.setChildDepth(2),e.showCard(1e3)},CGameBase.prototype.checkUno=function(e){var t=this._oTurnManager.getTurn();1===this._aPlayersHand[t].getLength()&&(this._bUNO=!0),this._oUnoController.check(e)},CGameBase.prototype.setUNO=function(e){this._bUNO=e},CGameBase.prototype.applyPenality=function(){this._bUNO=!1,this.drawCards(this._iCurPlayer,NUM_PENALTY_CARDS,0,DRAW_TYPE_PENALITY)},CGameBase.prototype._checkEffect=function(e){switch(e){case EFFECT_SELECT_COLOR:this._applySelectColor();break;case EFFECT_DRAW_FOUR:this._applyDrawFourEffect();break;case EFFECT_STOP:this._applyStopTurn();break;case EFFECT_INVERT_TURN:this._applyInvertTurn();break;case EFFECT_DRAW_TWO_COLORED:this._applyDrawTwoColored();break;default:this._applyNormalCardEffect()}},CGameBase.prototype.onDraw=function(){var e=!0;if(0!==this._oUsedCards.getLength()&&0===this._iCurPlayer){for(var t=0;t<this._aPlayersHand[0].getLength();t++){var n=this._aPlayersHand[0].getCardByIndex(t);this.cardMatchTheWaste(n)&&(e=!1)}!0===e&&(this._oDeck.disableInputDraw(),this._oDeck.hideHelp(),this.drawCards(0,1,0,DRAW_TYPE_NORMAL))}},CGameBase.prototype._checkNumberCardsToDraw=function(e,t,n,i){switch(this._iCounterDraw=t,i){case DRAW_TYPE_PENALITY:this.drawCardsTween(e,t,n,i);break;case DRAW_TYPE_DRAW2_COLORED:s_oCAnimation.drawTwoAnim(e,t,n,i);break;case DRAW_TYPE_DRAW4:s_oCAnimation.drawFourAnim(e,t,n,i);break;default:this.drawCardsTween(e,t,n,i)}},CGameBase.prototype.drawCardsTween=function(e,t,n,i){this._oCardsContainer.addChildAt(this._oDecksContainer,this._oCardsContainer.numChildren),this._oDeck.setOnTop(),this._aPlayersHand[e].organizeHand();var a=this._aPlayersHand[e].getContainerPos(),r=this._aPlayersHand[e].getPosNewCard(),s=this._oDeck.getGlobalPosition(),o=this,l=this._oDeck.takeLastCard();l.setOnTop();var c=a.x+r.x-s.x;a=a.y+r.y-s.y;var u=this._getCardRotation(e);createjs.Tween.get(l.getSprite()).wait(n).to({x:c,y:a,rotation:u},400,createjs.Ease.cubicOut).call(function(){o._aPlayersHand[e].pushCard(new CCard(o._aPlayersHand[e].getPosNewCard().x,o._aPlayersHand[e].getPosNewCard().y,o._aPlayersHand[e].getContainer(),l.getFotogram(),l.getRank(),l.getSuit(),l.getUniqueID(),u)),l.unload();var a=o._aPlayersHand[e].getLastCard();o.canCardBeShown(e)?a.showCard():playSound("card",1,!1),o._aPlayersHand[e].centerContainer(),o.checkForMoreDraws(e,t,n,i)})},CGameBase.prototype.checkForMoreDraws=function(e,t,n,i){0===this._oDeck.getLength()?this.shuffleCards(e,t,n,i):(this._iCounterDraw--,0<this._iCounterDraw?this.drawCardsTween(e,t,n,i):this._onAllCardsDrawCompleted(e,i))},CGameBase.prototype._checkEffectAfterDrawCompleted=function(e,t){switch(t){case DRAW_TYPE_PENALITY:this.applyEffectOnCard(this._oUsedCards.getLastCard().getEffect());break;case DRAW_TYPE_DRAW2_COLORED:case DRAW_TYPE_DRAW4:this._oTurnManager.nextTurn(),this._notifyChangeTurn();break;default:this._checkIfCanStillPlayTheTurn(e)}},CGameBase.prototype.onInputPlayer=function(e){for(var t=0;t<this._aPlayersHand[e].getLength();t++)this._aPlayersHand[e].getCardByIndex(t).onSetTurned()},CGameBase.prototype.offInputPlayer=function(e){for(var t=0;t<this._aPlayersHand[e].getLength();t++)this._aPlayersHand[e].getCardByIndex(t).offSetTurned()},CGameBase.prototype.setOffTurn=function(){for(var e=0;e<NUM_PLAYERS;e++)this._aPlayersHand[e].setOffTurn(e),this.offInputPlayer(e)},CGameBase.prototype.prevTurn=function(){this._oTurnManager.prevTurn()},CGameBase.prototype.getPlayerTurn=function(){return this._iCurPlayer},CGameBase.prototype.getbUNO=function(){return this._bUNO},CGameBase.prototype.cardCanBePlayed=function(e,t){if(e.getFotogram()===FOTOGRAM_DRAW_FOUR){for(var n=!1,i=0;i<this._aPlayersHand[t].getLength();i++){var a=this._aPlayersHand[t].getCardByIndex(i);if(a.getFotogram()!==FOTOGRAM_DRAW_FOUR&&(a.getRank()===this._oUsedCards.getLastCard().getRank()||a.getSuit()===this._iCurrentColor||a.getFotogram()===FOTOGRAM_COLOR)){n=!0;break}}n=!n}else n=e.getFotogram()===FOTOGRAM_COLOR||this.cardMatchTheWaste(e);return n},CGameBase.prototype.cardMatchTheWaste=function(e){var t=!1;return e.getRank()!==this._oUsedCards.getLastCard().getRank()&&e.getSuit()!==this._iCurrentColor&&e.getFotogram()!==FOTOGRAM_COLOR&&e.getFotogram()!==FOTOGRAM_DRAW_FOUR||(t=!0),t},CGameBase.prototype.playerCanPlay=function(e){for(var t=!1,n=0;n<this._aPlayersHand[e].getLength();n++){var i=this._aPlayersHand[e].getCardByIndex(n);if(this.cardMatchTheWaste(i)){t=!0;break}}return t},CGameBase.prototype._getCardRotation=function(e){var t=0;switch(this._aPlayersHand[e].getSide()){case BOTTOM:t=0;break;case LEFT:t=90;break;case TOP:t=180;break;case RIGHT:t=-90}return t},CGameBase.prototype.shuffle=function(e){var t;for(t=e.length;t;t--){var n=Math.floor(Math.random()*t),i=e[t-1];e[t-1]=e[n],e[n]=i}},CGameBase.prototype.unload=function(){this._oUnoController.unload(),this._oInterface.unload(),this._oSummaryPanel.unload(),this._oMsgBox.unload(),createjs.Tween.removeAllTweens(),s_oStage.removeAllChildren()},CGameBase.prototype.gameOver=function(e){this.setOffTurn(),this._showAllPlayersCards(),this._showAllPlayersMatchScore();var t=this._calculateMatchScore(),n=this._aPlayersHand[e].getScore()+t;this._aPlayersHand[e].setOnTurn(),this._aPlayersHand[e].setScore(n);var i=this._getPlayersRank();this._oSummaryPanel.setAndShow(i,e,t),n>=GAME_SCORE_WIN&&(this._bEndGame=!0,this._oSummaryPanel.endMode(sprintf(TEXT_PLAYER_WON,this._aPlayersHand[e].getName())),$(s_oMain).trigger("share_event",n))},CGameBase.prototype.checkWinner=function(){for(var e=null,t=0;t<this._aPlayersHand.length;t++)if(0===this._aPlayersHand[t].getLength()){e=t;break}return e},CGameBase.prototype._calculateMatchScore=function(){for(var e=0,t=0;t<this._aPlayersHand.length;t++)e+=this._aPlayersHand[t].calculateHandScore();return e},CGameBase.prototype._showAllPlayersCards=function(){for(var e=0;e<this._aPlayersHand.length;e++)this._aPlayersHand[e].getSide()!==BOTTOM&&this._aPlayersHand[e].showAllCards()},CGameBase.prototype._showAllPlayersMatchScore=function(){for(var e=0;e<this._aPlayersHand.length;e++){var t=this._aPlayersHand[e].calculateHandScore();0<this._aPlayersHand[e].getLength()?this._aPlayersHand[e].showHandScore(sprintf(TEXT_PTS_TO_WINNER,t)):this._aPlayersHand[e].showHandScore(TEXT_WINNER)}},CGameBase.prototype._getPlayersRank=function(){for(var e=[],t=0;t<this._aPlayersHand.length;t++){var n=this._aPlayersHand[t].getName(),i=this._aPlayersHand[t].getScore();e.push({name:n,score:i,index:t})}return e.sort(function(e,t){return e.score>t.score?-1:1}),e},CGameBase.prototype.matchCanStart=function(){for(var e=!1,t=0,n=0;n<this._aPlayersHand.length;n++)this._aPlayersHand[n].getLength()===STARTING_NUM_CARDS&&t++;return t===NUM_PLAYERS&&(e=!0),e},CGameBase.prototype._checkUnoNotify=function(e,t,n){e&&(n===t?(e=sprintf(TEXT_ALERT_1,NUM_PENALTY_CARDS),this._oUnoController.unoAnimation()):(e=this._aPlayersHand[n].getName().toUpperCase(),e=sprintf(TEXT_ALERT_2,e,NUM_PENALTY_CARDS)),this._oUnoController.showAlertMsg(e))},CGameBase.prototype.canCardBeShown=function(e){return this._aPlayersHand[e].getSide()===BOTTOM||DEBUG_SHOW_CARDS},CGameBase.prototype.getPlayersHand=function(e){return this._aPlayersHand[e]},CGameBase.prototype.getCurColor=function(e){return this._iCurrentColor},CGameBase.prototype.getLastCard=function(e){return this._oUsedCards.getLastCard()},CGameBase.prototype.update=function(){},CGameBase.prototype._onCheck=function(){this._oSummaryPanel.hide()},CGameSingle.prototype=Object.create(CGameBase.prototype),CGameSingle.prototype._startGame=function(){s_bFirstGame=!1,this._oUnoController.setVisible(!0),this._oUnoController.addEventListener(ON_APPLY_EFFECT,this.applyEffectOnCard,this),this._oUnoController.addEventListener(ON_APPLY_PENALITY,this.applyPenality,this),this._oUnoController.addEventListener(ON_UNO_CLICK,this._onUnoClick,this),this._oSummaryPanel.addEventListener(ON_NEXT,this._onConfirmNextMatch,this),this._oSummaryPanel.addEventListener(ON_HOME,this.onExit,this),this._oMsgBox.addEventListener(ON_HOME,this.onExit,this),this._setPieces()},CGameSingle.prototype._setPieces=function(){this._oDeck.initializeDeck(),this._oDeck.shuffle(),this.getFirstHand()},CGameSingle.prototype.setNewGame=function(){for(var e=0;e<this._aPlayersHand.length;e++)this._aPlayersHand[e].setScore(0);this._oTurnManager.resetFirstPlayer()},CGameSingle.prototype.restart=function(){this.reset(),this._setPieces()},CGameSingle.prototype._checkFirstCardEffect=function(e){switch(e){case EFFECT_SELECT_COLOR:this._oTurnManager.nextTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._applySelectColor(),this._oTurnManager.prevTurn();break;case EFFECT_DRAW_FOUR:this._oTurnManager.nextTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._iNextPlayer=this._iCurPlayer=this._oTurnManager.getTurn(),this._applyDrawFourEffect(),this._oTurnManager.prevTurn();break;case EFFECT_STOP:this._applyStopTurn();break;case EFFECT_INVERT_TURN:2!==NUM_PLAYERS&&this._oTurnManager.nextTurn(),this._applyInvertTurn();break;case EFFECT_DRAW_TWO_COLORED:this._applyDrawTwoColored();break;default:this._oTurnManager.nextTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),0===this._iCurPlayer?(this.onInputPlayer(this._iCurPlayer),this._oDeck.enableInputDraw()):this._oAIManager.selectACard(this._iCurPlayer),this._aPlayersHand[this._iCurPlayer].setOnTurn()}},CGameSingle.prototype.onNextTurn=function(){this._bUNO=!1;var e=this.checkWinner();null!==e?(this.gameOver(e),0===e&&$(s_oMain).trigger("save_score",this._calculateMatchScore())):(this.setOffTurn(),this._oDeck.enableInputDraw(),this._oTurnManager.nextTurn(),this._iCurPlayer=e=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._aPlayersHand[e].setOnTurn(),0===e?(this.onInputPlayer(e),this.playerCanPlay(e)||this._oDeck.setHelp()):this._oAIManager.selectACard(e))},CGameSingle.prototype.playCard=function(e,t){var n=this._oTurnManager.getTurn(),i=!1;0===n&&(i=this.cardCanBePlayed(e,n)),i&&(this._oCardsContainer.addChildAt(this._oHandsContainer,this._oCardsContainer.numChildren),this._aPlayersHand[n].setOnTop(),this._oDeck.disableInputDraw(),this.offInputPlayer(0),n=this._aPlayersHand[n].getContainerPos(),i=this._oUsedCards.getGlobalPosition(),playSound("card",1,!1),e.moveCard(i.x-n.x,i.y-n.y,0,300),e.showCard(),this._oUsedCards.setChildDepth(2))},CGameSingle.prototype.playedCard=function(e){var t=this._oTurnManager.getTurn(),n=this._aPlayersHand[t].searchIndexCard(e);this._oUsedCards.pushCard(new CCard(0,0,this._oUsedCards.getContainer(),e.getFotogram(),e.getRank(),e.getSuit(),e.getUniqueID(),0)),this._oUsedCards.disableInputUsedCards(),this._oUsedCards.getLastCard().instantShow(),this._aPlayersHand[t].removeCardByIndex(n),e.unload(),4!==this._oUsedCards.getLastCard().getSuit()&&(this._iCurrentColor=this._oUsedCards.getLastCard().getSuit(),this._oInterface.refreshColor(this._iCurrentColor)),this._aPlayersHand[t].organizeHand(n),this.checkUno(e.getEffect()),0!==t&&this._onUnoClick()},CGameSingle.prototype._onUnoClick=function(){!0===this._bUNO&&(this._bUNO=!1,this._aPlayersHand[this._iCurPlayer].checkUno())},CGameSingle.prototype.applyEffectOnCard=function(e){this._checkEffect(e)},CGameSingle.prototype._applySelectColor=function(){if(0===this._iCurPlayer)new CSelectColorPanel(EFFECT_SELECT_COLOR).addEventListener(ON_COLOR_SELECTED,function(e){this._onActionSelectColor({colorindex:e})},this);else{var e={colorindex:this._oAIManager.onSelectColorCpu(this._iCurPlayer)};this._onActionSelectColor(e)}},CGameSingle.prototype._applyDrawFourEffect=function(){if(0===this._iCurPlayer)new CSelectColorPanel(EFFECT_DRAW_FOUR).addEventListener(ON_COLOR_SELECTED,function(e){this._onActionDrawFour({playerindex:this._iNextPlayer,colorindex:e})},this);else{var e=this._oAIManager.onSelectColorCpu(this._iCurPlayer);this._onActionDrawFour({playerindex:this._iNextPlayer,colorindex:e})}},CGameSingle.prototype._applyStopTurn=function(){var e=this;this._oAnimation.stopTurn().then(function(){e._oTurnManager.nextTurn(),e._notifyChangeTurn()})},CGameSingle.prototype._applyInvertTurn=function(){var e=this;this._oTurnManager.changeClockWise(),2===NUM_PLAYERS&&this._oTurnManager.nextTurn(),this._oAnimation.changeClockWise(s_oGame._oTurnManager.getClockWise()).then(function(){e._notifyChangeTurn()})},CGameSingle.prototype._applyDrawTwoColored=function(){this.drawCards(this._iNextPlayer,2,0,DRAW_TYPE_DRAW2_COLORED)},CGameSingle.prototype._applyNormalCardEffect=function(){this._notifyChangeTurn()},CGameSingle.prototype.drawCards=function(e,t,n,i){this._checkUnoNotify(i===DRAW_TYPE_PENALITY,0,e),this._checkNumberCardsToDraw(e,t,n,i)},CGameSingle.prototype._notifyChangeTurn=function(){s_oGame.onNextTurn()},CGameSingle.prototype.shuffleCards=function(e,t,n,i){for(var a=this,r=this._oUsedCards.removeAllCardUnderTheDeck(),s=[],o=0;o<r.length;o++)s.push(r[o].getFotogram());console.log(s),this._oAnimation.shuffleAnimation().then(function(){shuffle(s),a._oDeck.clearCards(),a._oDeck.initializeFromData(s),a.checkForMoreDraws(e,t,n,i)})},CGameSingle.prototype._onAllCardsDrawCompleted=function(e,t){this._checkEffectAfterDrawCompleted(e,t)},CGameSingle.prototype._checkIfCanStillPlayTheTurn=function(e){this.playerCanPlay(e)?(this.onInputPlayer(e),0!==this._iCurPlayer&&this._oAIManager.selectACard(this._iCurPlayer)):(this._aPlayersHand[e].centerContainer(),this._notifyChangeTurn())},CGameSingle.prototype._onActionDrawFour=function(e){var t=this;this._iCurrentColor=e.colorindex,this._oAnimation.changeColor(this._iCurrentColor).then(function(){t._oInterface.refreshColor(t._iCurrentColor),t.drawCards(e.playerindex,NUM_WILD_CARDS,0,DRAW_TYPE_DRAW4)})},CGameSingle.prototype._onActionSelectColor=function(e){var t=this;this._iCurrentColor=e.colorindex,this._oAnimation.changeColor(this._iCurrentColor).then(function(){t._oInterface.refreshColor(t._iCurrentColor),t._notifyChangeTurn()})},CGameSingle.prototype._onConfirmNextMatch=function(){$(s_oMain).trigger("show_interlevel_ad"),this._bEndGame&&(this._bEndGame=!1,this.setNewGame()),this.restart()},CGameSingle.prototype.onExit=function(){s_oGame.unload(),s_oMain.gotoMenu(),$(s_oMain).trigger("end_session"),$(s_oMain).trigger("show_interlevel_ad")};var s_oInterface=null;function CCreditsPanel(){var e,t,n,i,a;this._init=function(){(t=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),t.alpha=0,t.on("mousedown",function(){}),s_oStage.addChild(t),new createjs.Tween.get(t).to({alpha:.7},500),n=new createjs.Container,s_oStage.addChild(n);var r=s_oSpriteLibrary.getSprite("credits_panel"),s=createBitmap(r);s.regX=r.width/2,s.regY=r.height/2,n.addChild(s),n.x=CANVAS_WIDTH/2,n.y=CANVAS_HEIGHT+r.height/2,e=n.y,new createjs.Tween.get(n).to({y:CANVAS_HEIGHT/2-40},500,createjs.Ease.quartIn),(s=new createjs.Text(TEXT_DEVELOPED,"20px "+PRIMARY_FONT,"#ffffff")).y=-r.height/2+80,s.textAlign="center",s.textBaseline="middle",s.lineWidth=300,n.addChild(s),(r=new createjs.Text("www.myslatetech.com","30px "+PRIMARY_FONT,"#ffffff")).y=80,r.textAlign="center",r.textBaseline="middle",r.lineWidth=500,n.addChild(r),r=s_oSpriteLibrary.getSprite("ctl_logo"),(a=createBitmap(r)).on("click",this._onLogoButRelease),a.regX=r.width/2,a.regY=r.height/2,n.addChild(a),r=s_oSpriteLibrary.getSprite("but_exit"),(i=new CGfxButton(230,-107,r,n)).addEventListener(ON_MOUSE_UP,this.unload,this)},this.unload=function(){i.setClickable(!1),new createjs.Tween.get(t).to({alpha:0},500),new createjs.Tween.get(n).to({y:e},400,createjs.Ease.backIn).call(function(){s_oStage.removeChild(t),s_oStage.removeChild(n),i.unload()}),t.off("mousedown",function(){}),a.off("mousedown",this._onLogoButRelease)},this._onLogoButRelease=function(){window.open("http://www.myslatetech.com/index.php?&l=en")},this._init()}function CSelectColorPanel(e){var t,n,i,a,r,s,o,l,c,u,h=this;this._init=function(){n=[],i=[],e===EFFECT_SELECT_COLOR&&playSound("special_card",.5,!1),(a=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),a.alpha=0,a.on("mousedown",function(){}),s_oStage.addChild(a),new createjs.Tween.get(a,{override:!0}).to({alpha:.7},500),r=new createjs.Container,s_oStage.addChild(r),s=new createjs.Container,r.addChild(s);var d=s_oSpriteLibrary.getSprite("select_color_panel"),_=createBitmap(d);_.regX=d.width/2,_.regY=d.height/2,r.addChildAt(_,0),r.x=CANVAS_WIDTH/2,r.y=CANVAS_HEIGHT+d.height/2,t=r.y,new createjs.Tween.get(r,{override:!0}).to({y:CANVAS_HEIGHT/2-40},600,createjs.Ease.backOut),new CTLText(r,-250,-d.height/2+10,500,110,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SELECT_COLOR,!0,!0,!0,!1),s.y=r.getBounds().height/5,d=s_oSpriteLibrary.getSprite("but_red"),(o=new CGfxButton(-190,-20,d,s)).addEventListener(ON_MOUSE_UP,function(){h.onSelectColor(0)}),d=s_oSpriteLibrary.getSprite("but_green"),(l=new CGfxButton(-65,-20,d,s)).addEventListener(ON_MOUSE_UP,function(){h.onSelectColor(1)}),d=s_oSpriteLibrary.getSprite("but_blue"),(c=new CGfxButton(65,-20,d,s)).addEventListener(ON_MOUSE_UP,function(){h.onSelectColor(2)}),d=s_oSpriteLibrary.getSprite("but_yellow"),(u=new CGfxButton(190,-20,d,s)).addEventListener(ON_MOUSE_UP,function(){h.onSelectColor(3)})},this.unload=function(){s_oStage.removeChild(a),s_oStage.removeChild(r),o.unload(),l.unload(),c.unload(),u.unload(),a.off("mousedown",function(){})},this.disableButtons=function(){o.setClickable(!1),l.setClickable(!1),c.setClickable(!1),u.setClickable(!1)},this.addEventListener=function(e,t,a){n[e]=t,i[e]=a},this.onSelectColor=function(s){new createjs.Tween.get(a,{override:!0}).to({alpha:0},500),new createjs.Tween.get(r,{override:!0}).to({y:t},400,createjs.Ease.backIn),h.disableButtons(),n[ON_COLOR_SELECTED]&&n[ON_COLOR_SELECTED].call(i[ON_COLOR_SELECTED],s,e)},h=this,this._init()}function CAreYouSurePanel(e){var t,n,i,a,r;this._init=function(e){(a=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),a.alpha=0,a.on("mousedown",function(){}),s_oStage.addChild(a),new createjs.Tween.get(a).to({alpha:.7},500),r=new createjs.Container,s_oStage.addChildAt(r,s_oStage.numChildren);var s=createBitmap(e=s_oSpriteLibrary.getSprite("credits_panel"));s.regX=e.width/2,s.regY=e.height/2,r.addChild(s),r.x=CANVAS_WIDTH/2,r.y=CANVAS_HEIGHT+e.height/2,t=r.y,new createjs.Tween.get(r).to({y:CANVAS_HEIGHT/2-40},500,createjs.Ease.quartIn).call(function(){}),new CTLText(r,-250,-130,500,150,50,"center","#000000",PRIMARY_FONT,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1).setOutline(5),new CTLText(r,-250,-130,500,150,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1),(n=new CGfxButton(110,80,s_oSpriteLibrary.getSprite("but_yes_big"),r)).addEventListener(ON_MOUSE_UP,this._onButYes,this),(i=new CGfxButton(-110,80,s_oSpriteLibrary.getSprite("but_exit_big"),r)).addEventListener(ON_MOUSE_UP,this._onButNo,this)},this._onButYes=function(){i.setClickable(!1),n.setClickable(!1),new createjs.Tween.get(a).to({alpha:0},500),new createjs.Tween.get(r).to({y:t},400,createjs.Ease.backIn).call(function(){e(),s.unload()})},this._onButNo=function(){i.setClickable(!1),n.setClickable(!1),new createjs.Tween.get(a).to({alpha:0},500),new createjs.Tween.get(r).to({y:t},400,createjs.Ease.backIn).call(function(){s.unload()})},this.unload=function(){i.unload(),n.unload(),s_oStage.removeChild(a),s_oStage.removeChild(r),a.off("mousedown",function(){})};var s=this;this._init(e)}function CAIManager(){this._init=function(){},this.unload=function(){},this.onSelectColorCpu=function(e){e=s_oGame.getPlayersHand(e);for(var t,n=[{iColor:0,iPoints:0},{iColor:1,iPoints:0},{iColor:2,iPoints:0},{iColor:3,iPoints:0}],i=0;i<e.getLength();i++){t=e.getCardByIndex(i);for(var a=0;a<n.length;a++)t.getSuit()===a&&n[a].iPoints++}return n.sort(function(e,t){return parseFloat(t.iPoints)-parseFloat(e.iPoints)}),n[0].iColor},this.selectACard=function(e){for(var t=s_oGame.getPlayersHand(e),n=s_oGame.getCurColor(),i=s_oGame.getLastCard(),a=[],r=0;r<t.getLength();r++)4===t.getCardByIndex(r).getSuit()||t.getCardByIndex(r).getRank()!==i.getRank()&&t.getCardByIndex(r).getSuit()!==n?t.getCardByIndex(r).getFotogram()===FOTOGRAM_COLOR?a.push({oCard:t.getCardByIndex(r),iValue:2}):t.getCardByIndex(r).getFotogram()===FOTOGRAM_DRAW_FOUR&&a.push({oCard:t.getCardByIndex(r),iValue:1}):12===t.getCardByIndex(r).getRank()?a.push({oCard:t.getCardByIndex(r),iValue:6}):10===t.getCardByIndex(r).getRank()?a.push({oCard:t.getCardByIndex(r),iValue:5}):11===t.getCardByIndex(r).getRank()?a.push({oCard:t.getCardByIndex(r),iValue:4}):a.push({oCard:t.getCardByIndex(r),iValue:3});0===a.length?s_oGame.drawCards(e,1,1e3,DRAW_TYPE_NORMAL):(a.sort(function(e,t){return parseFloat(t.iValue)-parseFloat(e.iValue)}),s_oGame.cpuPlayCard(a[0].oCard))},this._init()}function CUnoController(){var e,t,n,i,a;this._init=function(){e=[],t=[],(i=new createjs.Container).visible=!1,s_oStage.addChild(i);var r=s_oSpriteLibrary.getSprite("but_uno");(a=new CGfxButton(CANVAS_WIDTH/2+222,CANVAS_HEIGHT/2+70,r,i)).addEventListener(ON_MOUSE_UP,this._onButUno,this),(n=new CTLText(i,CANVAS_WIDTH/2+280,CANVAS_HEIGHT/2,200,150,50,"center","#fff",PRIMARY_FONT,1,0,0,sprintf(TEXT_ALERT_1,NUM_PENALTY_CARDS),!0,!0,!0,!1)).setAlpha(0)},this.unload=function(){a.unload()},this.addEventListener=function(n,i,a){e[n]=i,t[n]=a},this.setVisible=function(e){i.visible=e},this.check=function(e){!0===s_oGame.getbUNO()?setTimeout(function(){!0===s_oGame.getbUNO()?r._triggerPenality():r._triggerEffect(e)},2e3):r._triggerEffect(e)},this._triggerPenality=function(){e[ON_APPLY_PENALITY]&&e[ON_APPLY_PENALITY].call(t[ON_APPLY_PENALITY])},this._triggerEffect=function(n){e[ON_APPLY_EFFECT]&&e[ON_APPLY_EFFECT].call(t[ON_APPLY_EFFECT],n)},this._onButUno=function(){e[ON_UNO_CLICK]&&e[ON_UNO_CLICK].call(t[ON_UNO_CLICK])},this.showAlertMsg=function(e){n.refreshText(e),createjs.Tween.get(n.getText()).to({alpha:1},400).wait(4e3).to({alpha:0},400).call(function(){a.removeAnimation()})},this.unoAnimation=function(){a.trembleAnimation()};var r=this;this._init()}function CSummaryPanel(e){var t,n,i,a,r,s,o,l,c,u,h,d,_,p;this._init=function(){t=[],n=[],(r=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),r.alpha=0,r.on("mousedown",function(){}),e.addChild(r),(o=new createjs.Container).alpha=0,o.visible=!1,e.addChild(o);var f=s_oSpriteLibrary.getSprite("msg_box");f=(s=createBitmap(f)).getBounds(),s.regX=f.width/2,s.regY=f.height/2,s.x=CANVAS_WIDTH/2,s.y=CANVAS_HEIGHT/2,o.addChild(s),(u=new createjs.Container).x=s.x,u.y=s.y-10,o.addChild(u);var g=NUM_PLAYERS;f=40*g,a=[];for(var C=0;C<g;C++)a[C]=new CPlayerInfo(0,0,u,"szPlayerName"),a[C].setPosition(0,-f/2+f/(g-1)*C,BOTTOM);i="#35bd1b",(c=new createjs.Text(0," 30px "+PRIMARY_FONT,i)).textBaseline="middle",u.addChild(c),l=new CTLText(o,(g=CANVAS_WIDTH/2)-250,(C=CANVAS_HEIGHT/2-185)-(f=150)/2,500,f,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SUMMARY,!0,!0,!0,!1),f=s_oSpriteLibrary.getSprite("cup_icon"),(h=createBitmap(f)).regX=f.width/2,h.regY=f.height/2,h.x=-300,h.y=a[0].getTextScorePos().y,h.visible=!1,u.addChild(h),f=s_oSpriteLibrary.getSprite("but_home"),(d=new CGfxButton(CANVAS_WIDTH/2-180,CANVAS_HEIGHT/2+170,f,o)).addEventListener(ON_MOUSE_DOWN,this._onExit,this),f=s_oSpriteLibrary.getSprite("but_show"),(_=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+170,f,o)).addEventListener(ON_MOUSE_DOWN,this._onShow,this),f=s_oSpriteLibrary.getSprite("but_next"),(p=new CGfxButton(CANVAS_WIDTH/2+180,CANVAS_HEIGHT/2+170,f,o)).addEventListener(ON_MOUSE_DOWN,this._onNext,this),p.pulseAnimation()},this.unload=function(){p.unload(),_.unload(),d.unload(),r.removeAllEventListeners(),o.removeAllEventListeners(),e.removeChild(r),e.removeChild(o)},this.addEventListener=function(e,i,a){t[e]=i,n[e]=a},this.setAndShow=function(e,t,n){for(var i=0;i<a.length;i++)if(a[i].setName(e[i].name),a[i].setScore(e[i].score+" /"+GAME_SCORE_WIN),e[i].index===t){var s=a[i].getTextScorePos();c.x=s.x+46,c.y=s.y+18,c.text="(+"+n+")",a[i].highlight()}playSound("game_over",1,!1),o.visible=!0,createjs.Tween.get(r).to({alpha:.7},500),createjs.Tween.get(o).to({alpha:1},500)},this.reset=function(){o.visible=!1,r.alpha=0,r.on("mousedown",function(){}),h.visible=!1,l.setY(CANVAS_HEIGHT/2-185-75),l.refreshText(TEXT_SUMMARY),u.visible=!0,d.setX(CANVAS_WIDTH/2-180),_.setX(CANVAS_WIDTH/2),p.setX(CANVAS_WIDTH/2+180),d.setVisible(!0),_.setVisible(!0),p.setVisible(!0);var e=s_oSpriteLibrary.getSprite("but_next");for(p.setImage(e),e=0;e<a.length;e++)a[e].enable(),a[e].setNameColor("#FFF")},this.show=function(){o.visible=!0,r.alpha=.7,r.removeAllEventListeners(),r.on("mousedown",function(){})},this.hide=function(){o.visible=!1,r.alpha=.01,r.removeAllEventListeners(),r.on("mousedown",this.show,this)},this.waitingMode=function(){o.visible=!0,o.alpha=1,r.alpha=.7,u.visible=!1,l.refreshText(TEXT_WAIT_OPPONENT),l.setY(CANVAS_HEIGHT/2-50-75),d.setX(CANVAS_WIDTH/2-100),p.setVisible(!1),_.setX(CANVAS_WIDTH/2+100)},this.playerQuitMode=function(e){o.visible=!0,o.alpha=1,r.alpha=.7,l.refreshText(e.toUpperCase()),d.setX(CANVAS_WIDTH/2-100),p.setVisible(!1),_.setX(CANVAS_WIDTH/2+100)},this.endMode=function(e){l.refreshText(e.toUpperCase()),e=s_oSpriteLibrary.getSprite("but_restart"),p.setImage(e),a[0].setNameColor(i),h.visible=!0},this.isShown=function(){return o.visible},this.stopTweens=function(){createjs.Tween.removeTweens(r),createjs.Tween.removeTweens(o)},this._onExit=function(){f.stopTweens(),t[ON_HOME]&&t[ON_HOME].call(n[ON_HOME])},this._onShow=function(){f.stopTweens(),t[ON_CHECK]&&t[ON_CHECK].call(n[ON_CHECK])},this._onNext=function(){f.stopTweens(),t[ON_NEXT]&&t[ON_NEXT].call(n[ON_NEXT])},this._init();var f=this;return this}function CPlayerInfo(e,t,n,i){var a,r,s,o,l,c,u,h,d,_,p;this._init=function(e,t,n,i){a=i,r=10,(c=new createjs.Container).x=e,c.y=t,n.addChild(c),u=new createjs.Container,c.addChild(u),e=s_oSpriteLibrary.getSprite("line_player"),s=e.width/2,o=e.height,e=new createjs.SpriteSheet({images:[e],frames:{width:s,height:o,regX:s/2,regY:o/2},animations:{off:[0],on:[1],idle:{frames:[0,1],speed:.1}}}),(h=createSprite(e,"off",s/2,o/2,s,o)).stop(),c.addChild(h),d=new CTLText(u,0,0,340,l=40,30,"left","#fff",PRIMARY_FONT,1,0,0,a,!0,!0,!1,!1),e=s_oSpriteLibrary.getSprite("score_icon"),(p=createBitmap(e)).regX=e.width/2,p.regY=e.height/2,u.addChild(p),_=new CTLText(u,0,0,100,l,30,"left","#fff",PRIMARY_FONT,1,0,0,"0",!0,!0,!1,!1)},this.unload=function(){n.removeChild(c)},this.highlight=function(){h.gotoAndStop("on"),u.alpha=1,createjs.Tween.get(d.getText(),{override:!0,loop:!0}).to({alpha:0},500,createjs.Ease.cubicIn).to({alpha:1},500,createjs.Ease.cubicOut).wait(500)},this.enable=function(){h.gotoAndStop("on"),d.setAlpha(1),u.alpha=1,createjs.Tween.removeTweens(d.getText())},this.disable=function(){h.gotoAndStop("off"),d.setAlpha(1),u.alpha=.15,createjs.Tween.removeTweens(d.getText())},this.setScore=function(e){_.refreshText(e)},this.setName=function(e){d.refreshText(e)},this.setPosition=function(e,t,n){switch(c.x=e,c.y=t,n){case BOTTOM:this._setBottom();break;case TOP:this._setTop();break;case LEFT:this._setLeft();break;case RIGHT:this._setRight()}},this._setBottom=function(){this._setNormalDir(),c.rotation=0},this._setTop=function(){this._setInverseDir(),c.rotation=0},this._setLeft=function(){this._setNormalDir(),c.rotation=90},this._setRight=function(){this._setInverseDir(),c.rotation=90},this._setNormalDir=function(){d.setAlign("left"),d.setPos(-s/2+r,-l),p.x=s/2-r-p.getBounds().width/2,p.y=d.getY()+l/2-2,_.setAlign("right"),_.setPos(p.x-p.getBounds().width/2-2,d.getY())},this._setInverseDir=function(){d.setAlign("right"),d.setPos(s/2-r,4),p.x=-s/2+r+p.getBounds().width/2,p.y=d.getY()+l/2-2,_.setAlign("left"),_.setPos(p.x+p.getBounds().width/2+2,d.getY())},this.getTextScorePos=function(){return{x:c.x+_.getX(),y:c.y+_.getY()}},this.setNameColor=function(e){d.setColor(e)},this._init(e,t,n,i)}function CInfoLabel(e,t,n){var i,a;this._init=function(e,t,n){(i=new createjs.Container).x=e,i.y=t,n.addChild(i),(t=createBitmap(e=s_oSpriteLibrary.getSprite("info_label"))).regX=e.width/2,t.regY=e.height/2,i.addChild(t),e=e.width-20,a=new CTLText(i,-e/2,-40,e,80,30,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_PTS_TO_WINNER,0),!0,!0,!0,!1),this.pulseAnimation()},this.setOnTop=function(){n.setChildIndex(i,n.numChildren-1)},this.setPosition=function(e,t,n){i.x=e,i.y=t},this.setTextScore=function(e){a.refreshText(e)},this.setVisible=function(e){i.visible=e},this.pulseAnimation=function(){createjs.Tween.get(i,{loop:!0}).to({scaleX:.9,scaleY:.9},850,createjs.Ease.quadOut).to({scaleX:1,scaleY:1},650,createjs.Ease.quadIn)},this._init(e,t,n)}function CMsgBox(e){var t,n,i,a,r,s,o;this._init=function(e){t=[],n=[],(i=new createjs.Shape).graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),i.alpha=0,i.on("mousedown",function(){}),e.addChild(i),(a=new createjs.Container).alpha=0,a.visible=!1,e.addChild(a),e=s_oSpriteLibrary.getSprite("msg_box"),e=(r=createBitmap(e)).getBounds(),r.regX=e.width/2,r.regY=e.height/2,r.x=CANVAS_WIDTH/2,r.y=CANVAS_HEIGHT/2,a.addChild(r),s=new CTLText(a,CANVAS_WIDTH/2-250,CANVAS_HEIGHT/2-50-75,500,150,50,"center","#fff",PRIMARY_FONT,1,0,0," ",!0,!0,!0,!1),e=s_oSpriteLibrary.getSprite("but_home"),(o=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+170,e,a)).addEventListener(ON_MOUSE_DOWN,this._onExit,this)},this.unload=function(){o.unload(),i.removeAllEventListeners(),a.removeAllEventListeners(),e.removeChild(i),e.removeChild(a)},this.addEventListener=function(e,i,a){t[e]=i,n[e]=a},this.show=function(e){playSound("game_over",1,!1),a.visible=!0,s.refreshText(e.toUpperCase()),createjs.Tween.get(i).to({alpha:.7},500),createjs.Tween.get(a).to({alpha:1},500)},this._onExit=function(){t[ON_HOME]&&t[ON_HOME].call(n[ON_HOME])},this.isShown=function(){return a.visible},this._init(e)}